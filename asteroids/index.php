<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> <!--320-->
</head>
<body>
<canvas id="umCanvas" width="800" height="600">
<audio id="selectLoop">
<source src="selectLoop.mp3" type ="audio/mpeg">
</audio>
<audio id="loopA">
<source src="loopA.mp3" type ="audio/mpeg">
</audio>
<script> 
/*! howler.js v2.0.2 | (c) 2013-2016, James Simpson of GoldFire Studios | MIT License | howlerjs.com */
!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||n;return e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||n;if(e=parseFloat(e),t.ctx||_(),"undefined"!=typeof e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&(t.masterGain.gain.value=e);for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var r=t._howls[o]._getSoundIds(),u=0;u<r.length;u++){var a=t._howls[o]._soundById(r[u]);a&&a._node&&(a._node.volume=a._volume*e)}return t}return t._volume},mute:function(e){var t=this||n;t.ctx||_(),t._muted=e,t.usingWebAudio&&(t.masterGain.gain.value=e?0:t._volume);for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var r=t._howls[o]._getSoundIds(),u=0;u<r.length;u++){var a=t._howls[o]._soundById(r[u]);a&&a._node&&(a._node.muted=!!e||a._muted)}return t},unload:function(){for(var e=this||n,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&"undefined"!=typeof e.ctx.close&&(e.ctx.close(),e.ctx=null,_()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||n;if(e.state=e.ctx?e.ctx.state||"running":"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{var t=new Audio;"undefined"==typeof t.oncanplaythrough&&(e._canPlayEvent="canplay")}catch(n){e.noAudio=!0}else e.noAudio=!0;try{var t=new Audio;t.muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(n){return e}if(!t||"function"!=typeof t.canPlayType)return e;var o=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),u=r&&parseInt(r[0].split("/")[1],10)<33;return e._codecs={mp3:!(u||!o&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!o,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||n,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),o=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||o)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var r=function(){var n=e.ctx.createBufferSource();n.buffer=e._scratchBuffer,n.connect(e.ctx.destination),"undefined"==typeof n.start?n.noteOn(0):n.start(0),n.onended=function(){n.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchend",r,!0)}};return document.addEventListener("touchend",r,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&"undefined"!=typeof e.ctx.suspend&&n.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var o=0;o<e._howls[t]._sounds.length;o++)if(!e._howls[t]._sounds[o]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&"undefined"!=typeof e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.state="resuming",e.ctx.resume().then(function(){e.state="running";for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e,t=function(e){var n=this;return e.src&&0!==e.src.length?void n.init(e):void console.error("An array of source files must be passed with any new Howl.")};t.prototype={init:function(e){var t=this;return n.ctx||_(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=n.usingWebAudio&&!t._html5,"undefined"!=typeof n.ctx&&n.ctx&&n.mobileAutoEnable&&n._enableMobileAudio(),n._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=this,t=null;if(n.noAudio)return void e._emit("loaderror",null,"No audio support.");"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var a,d;if(e._format&&e._format[r])a=e._format[r];else{if(d=e._src[r],"string"!=typeof d){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}a=/^data:audio\/([^;,]+);/i.exec(d),a||(a=/\.([^.]+)$/.exec(d.split("?",1)[0])),a&&(a=a[1].toLowerCase())}if(n.codecs(a)){t=e._src[r];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&u(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(e,t){var o=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if("undefined"==typeof e){e="__default";for(var u=0,a=0;a<o._sounds.length;a++)o._sounds[a]._paused&&!o._sounds[a]._ended&&(u++,r=o._sounds[a]._id);1===u?e=null:r=null}}var d=r?o._soundById(r):o._inactiveSound();if(!d)return null;if(r&&!e&&(e=d._sprite||"__default"),"loaded"!==o._state&&!o._sprite[e])return o._queue.push({event:"play",action:function(){o.play(o._soundById(d._id)?d._id:void 0)}}),d._id;if(r&&!d._paused)return t||setTimeout(function(){o._emit("play",d._id)},0),d._id;o._webAudio&&n._autoResume();var i=Math.max(0,d._seek>0?d._seek:o._sprite[e][0]/1e3),_=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-i),s=1e3*_/Math.abs(d._rate);d._paused=!1,d._ended=!1,d._sprite=e,d._seek=i,d._start=o._sprite[e][0]/1e3,d._stop=(o._sprite[e][0]+o._sprite[e][1])/1e3,d._loop=!(!d._loop&&!o._sprite[e][2]);var l=d._node;if(o._webAudio){var f=function(){o._refreshBuffer(d);var e=d._muted||o._muted?0:d._volume;l.gain.setValueAtTime(e,n.ctx.currentTime),d._playStart=n.ctx.currentTime,"undefined"==typeof l.bufferSource.start?d._loop?l.bufferSource.noteGrainOn(0,i,86400):l.bufferSource.noteGrainOn(0,i,_):d._loop?l.bufferSource.start(0,i,86400):l.bufferSource.start(0,i,_),s!==1/0&&(o._endTimers[d._id]=setTimeout(o._ended.bind(o,d),s)),t||setTimeout(function(){o._emit("play",d._id)},0)},c="running"===n.state;"loaded"===o._state&&c?f():(o.once(c?"load":"resume",f,c?d._id:null),o._clearTimer(d._id))}else{var p=function(){l.currentTime=i,l.muted=d._muted||o._muted||n._muted||l.muted,l.volume=d._volume*n.volume(),l.playbackRate=d._rate,setTimeout(function(){l.play(),s!==1/0&&(o._endTimers[d._id]=setTimeout(o._ended.bind(o,d),s)),t||o._emit("play",d._id)},0)},m="loaded"===o._state&&(window&&window.ejecta||!l.readyState&&n._navigator.isCocoonJS);if(4===l.readyState||m)p();else{var v=function(){p(),l.removeEventListener(n._canPlayEvent,v,!1)};l.addEventListener(n._canPlayEvent,v,!1),o._clearTimer(d._id)}}return d._id},pause:function(e){var n=this;if("loaded"!==n._state)return n._queue.push({event:"pause",action:function(){n.pause(e)}}),n;for(var t=n._getSoundIds(e),o=0;o<t.length;o++){n._clearTimer(t[o]);var r=n._soundById(t[o]);if(r&&!r._paused&&(r._seek=n.seek(t[o]),r._rateSeek=0,r._paused=!0,n._stopFade(t[o]),r._node))if(n._webAudio){if(!r._node.bufferSource)return n;"undefined"==typeof r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||n._emit("pause",r?r._id:null)}return n},stop:function(e,n){var t=this;if("loaded"!==t._state)return t._queue.push({event:"stop",action:function(){t.stop(e)}}),t;for(var o=t._getSoundIds(e),r=0;r<o.length;r++){t._clearTimer(o[r]);var u=t._soundById(o[r]);if(u&&(u._seek=u._start||0,u._rateSeek=0,u._paused=!0,u._ended=!0,t._stopFade(o[r]),u._node))if(t._webAudio){if(!u._node.bufferSource)return n||t._emit("stop",u._id),t;"undefined"==typeof u._node.bufferSource.stop?u._node.bufferSource.noteOff(0):u._node.bufferSource.stop(0),t._cleanBuffer(u._node)}else isNaN(u._node.duration)&&u._node.duration!==1/0||(u._node.currentTime=u._start||0,u._node.pause());u&&!n&&t._emit("stop",u._id)}return t},mute:function(e,t){var o=this;if("loaded"!==o._state)return o._queue.push({event:"mute",action:function(){o.mute(e,t)}}),o;if("undefined"==typeof t){if("boolean"!=typeof e)return o._muted;o._muted=e}for(var r=o._getSoundIds(t),u=0;u<r.length;u++){var a=o._soundById(r[u]);a&&(a._muted=e,o._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,n.ctx.currentTime):a._node&&(a._node.muted=!!n._muted||e),o._emit("mute",a._id))}return o},volume:function(){var e,t,o=this,r=arguments;if(0===r.length)return o._volume;if(1===r.length||2===r.length&&"undefined"==typeof r[1]){var u=o._getSoundIds(),a=u.indexOf(r[0]);a>=0?t=parseInt(r[0],10):e=parseFloat(r[0])}else r.length>=2&&(e=parseFloat(r[0]),t=parseInt(r[1],10));var d;if(!("undefined"!=typeof e&&e>=0&&e<=1))return d=t?o._soundById(t):o._sounds[0],d?d._volume:0;if("loaded"!==o._state)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,r)}}),o;"undefined"==typeof t&&(o._volume=e),t=o._getSoundIds(t);for(var i=0;i<t.length;i++)d=o._soundById(t[i]),d&&(d._volume=e,r[2]||o._stopFade(t[i]),o._webAudio&&d._node&&!d._muted?d._node.gain.setValueAtTime(e,n.ctx.currentTime):d._node&&!d._muted&&(d._node.volume=e*n.volume()),o._emit("volume",d._id));return o},fade:function(e,t,o,r){var u=this,a=Math.abs(e-t),d=e>t?"out":"in",i=a/.01,_=i>0?o/i:o;if(_<4&&(i=Math.ceil(i/(4/_)),_=4),"loaded"!==u._state)return u._queue.push({event:"fade",action:function(){u.fade(e,t,o,r)}}),u;u.volume(e,r);for(var s=u._getSoundIds(r),l=0;l<s.length;l++){var f=u._soundById(s[l]);if(f){if(r||u._stopFade(s[l]),u._webAudio&&!f._muted){var c=n.ctx.currentTime,p=c+o/1e3;f._volume=e,f._node.gain.setValueAtTime(e,c),f._node.gain.linearRampToValueAtTime(t,p)}var m=e;f._interval=setInterval(function(e,n){i>0&&(m+="in"===d?.01:-.01),m=Math.max(0,m),m=Math.min(1,m),m=Math.round(100*m)/100,u._webAudio?("undefined"==typeof r&&(u._volume=m),n._volume=m):u.volume(m,e,!0),m===t&&(clearInterval(n._interval),n._interval=null,u.volume(m,e),u._emit("fade",e))}.bind(u,s[l],f),_)}}return u},_stopFade:function(e){var t=this,o=t._soundById(e);return o&&o._interval&&(t._webAudio&&o._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(o._interval),o._interval=null,t._emit("fade",e)),t},loop:function(){var e,n,t,o=this,r=arguments;if(0===r.length)return o._loop;if(1===r.length){if("boolean"!=typeof r[0])return t=o._soundById(parseInt(r[0],10)),!!t&&t._loop;e=r[0],o._loop=e}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var u=o._getSoundIds(n),a=0;a<u.length;a++)t=o._soundById(u[a]),t&&(t._loop=e,o._webAudio&&t._node&&t._node.bufferSource&&(t._node.bufferSource.loop=e,e&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop)));return o},rate:function(){var e,t,o=this,r=arguments;if(0===r.length)t=o._sounds[0]._id;else if(1===r.length){var u=o._getSoundIds(),a=u.indexOf(r[0]);a>=0?t=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));var d;if("number"!=typeof e)return d=o._soundById(t),d?d._rate:o._rate;if("loaded"!==o._state)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,r)}}),o;"undefined"==typeof t&&(o._rate=e),t=o._getSoundIds(t);for(var i=0;i<t.length;i++)if(d=o._soundById(t[i])){d._rateSeek=o.seek(t[i]),d._playStart=o._webAudio?n.ctx.currentTime:d._playStart,d._rate=e,o._webAudio&&d._node&&d._node.bufferSource?d._node.bufferSource.playbackRate.value=e:d._node&&(d._node.playbackRate=e);var _=o.seek(t[i]),s=(o._sprite[d._sprite][0]+o._sprite[d._sprite][1])/1e3-_,l=1e3*s/Math.abs(d._rate);!o._endTimers[t[i]]&&d._paused||(o._clearTimer(t[i]),o._endTimers[t[i]]=setTimeout(o._ended.bind(o,d),l)),o._emit("rate",d._id)}return o},seek:function(){var e,t,o=this,r=arguments;if(0===r.length)t=o._sounds[0]._id;else if(1===r.length){var u=o._getSoundIds(),a=u.indexOf(r[0]);a>=0?t=parseInt(r[0],10):(t=o._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if("undefined"==typeof t)return o;if("loaded"!==o._state)return o._queue.push({event:"seek",action:function(){o.seek.apply(o,r)}}),o;var d=o._soundById(t);if(d){if(!("number"==typeof e&&e>=0)){if(o._webAudio){var i=o.playing(t)?n.ctx.currentTime-d._playStart:0,_=d._rateSeek?d._rateSeek-d._seek:0;return d._seek+(_+i*Math.abs(d._rate))}return d._node.currentTime}var s=o.playing(t);s&&o.pause(t,!0),d._seek=e,d._ended=!1,o._clearTimer(t),s&&o.play(t,!0),!o._webAudio&&d._node&&(d._node.currentTime=e),o._emit("seek",t)}return o},playing:function(e){var n=this;if("number"==typeof e){var t=n._soundById(e);return!!t&&!t._paused}for(var o=0;o<n._sounds.length;o++)if(!n._sounds[o]._paused)return!0;return!1},duration:function(e){var n=this,t=n._duration,o=n._soundById(e);return o&&(t=n._sprite[o._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,o=0;o<t.length;o++){t[o]._paused||(e.stop(t[o]._id),e._emit("end",t[o]._id)),e._webAudio||(t[o]._node.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",t[o]._node.removeEventListener("error",t[o]._errorFn,!1),t[o]._node.removeEventListener(n._canPlayEvent,t[o]._loadFn,!1)),delete t[o]._node,e._clearTimer(t[o]._id);var u=n._howls.indexOf(e);u>=0&&n._howls.splice(u,1)}var a=!0;for(o=0;o<n._howls.length;o++)if(n._howls[o]._src===e._src){a=!1;break}return r&&a&&delete r[e._src],n.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,n,t,o){var r=this,u=r["_on"+e];return"function"==typeof n&&u.push(o?{id:t,fn:n,once:o}:{id:t,fn:n}),r},off:function(e,n,t){var o=this,r=o["_on"+e],u=0;if(n){for(u=0;u<r.length;u++)if(n===r[u].fn&&t===r[u].id){r.splice(u,1);break}}else if(e)o["_on"+e]=[];else{var a=Object.keys(o);for(u=0;u<a.length;u++)0===a[u].indexOf("_on")&&Array.isArray(o[a[u]])&&(o[a[u]]=[])}return o},once:function(e,n,t){var o=this;return o.on(e,n,t,1),o},_emit:function(e,n,t){for(var o=this,r=o["_on"+e],u=r.length-1;u>=0;u--)r[u].id&&r[u].id!==n&&"load"!==e||(setTimeout(function(e){e.call(this,n,t)}.bind(o,r[u].fn),0),r[u].once&&o.off(e,r[u].fn,r[u].id));return o},_loadQueue:function(){var e=this;if(e._queue.length>0){var n=e._queue[0];e.once(n.event,function(){e._queue.shift(),e._loadQueue()}),n.action()}return e},_ended:function(e){var t=this,o=e._sprite,r=!(!e._loop&&!t._sprite[o][2]);if(t._emit("end",e._id),!t._webAudio&&r&&t.stop(e._id,!0).play(e._id),t._webAudio&&r){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var u=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),u)}return t._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),n._autoSuspend()),t._webAudio||r||t.stop(e._id),t},_clearTimer:function(e){var n=this;return n._endTimers[e]&&(clearTimeout(n._endTimers[e]),delete n._endTimers[e]),n},_soundById:function(e){for(var n=this,t=0;t<n._sounds.length;t++)if(e===n._sounds[t]._id)return n._sounds[t];return null},_inactiveSound:function(){var e=this;e._drain();for(var n=0;n<e._sounds.length;n++)if(e._sounds[n]._ended)return e._sounds[n].reset();return new o(e)},_drain:function(){var e=this,n=e._pool,t=0,o=0;if(!(e._sounds.length<n)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&t++;for(o=e._sounds.length-1;o>=0;o--){if(t<=n)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),t--)}}},_getSoundIds:function(e){var n=this;if("undefined"==typeof e){for(var t=[],o=0;o<n._sounds.length;o++)t.push(n._sounds[o]._id);return t}return[e]},_refreshBuffer:function(e){var t=this;return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=r[t._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.value=e._rate,t},_cleanBuffer:function(e){var n=this;if(n._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=n._scratchBuffer}catch(e){}}return e.bufferSource=null,n}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._muted=n._muted,e._rate=n._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=Math.round(Date.now()*Math.random()),n._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,o=n._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node="undefined"==typeof n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(o,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._node.src=t._src,e._node.preload="auto",e._node.volume=o*n.volume(),e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._muted=n._muted,e._rate=n._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=Math.round(Date.now()*Math.random()),e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorListener,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)}};var r={},u=function(e){var n=e._src;if(r[n])return e._duration=r[n].duration,void i(e);if(/^data:[^;]+;base64,/.test(n)){for(var t=atob(n.split(",")[1]),o=new Uint8Array(t.length),u=0;u<t.length;++u)o[u]=t.charCodeAt(u);d(o.buffer,e)}else{var _=new XMLHttpRequest;_.open("GET",n,!0),_.responseType="arraybuffer",_.onload=function(){var n=(_.status+"")[0];return"0"!==n&&"2"!==n&&"3"!==n?void e._emit("loaderror",null,"Failed loading audio file with status: "+_.status+"."):void d(_.response,e)},_.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[n],e.load())},a(_)}},a=function(e){try{e.send()}catch(n){e.onerror()}},d=function(e,t){n.ctx.decodeAudioData(e,function(e){e&&t._sounds.length>0&&(r[t._src]=e,i(t,e))},function(){t._emit("loaderror",null,"Decoding audio data failed.")})},i=function(e,n){n&&!e._duration&&(e._duration=n.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},_=function(){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),t=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=t?parseInt(t[1],10):null;if(e&&o&&o<9){var r=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());(n._navigator&&n._navigator.standalone&&!r||n._navigator&&!n._navigator.standalone&&!r)&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain="undefined"==typeof n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.value=1,n.masterGain.connect(n.ctx.destination)),n._setup()};"function"==typeof define&&define.amd&&define([],function(){return{Howler:n,Howl:t}}),"undefined"!=typeof exports&&(exports.Howler=n,exports.Howl=t),"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=n,window.Howl=t,window.Sound=o):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=n,global.Howl=t,global.Sound=o)}();/*! howler.js v2.0.2 | Spatial Plugin | (c) 2013-2016, James Simpson of GoldFire Studios | MIT License | howlerjs.com */
!function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var t=n._howls.length-1;t>=0;t--)n._howls[t].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,t){var o=this;return o.ctx&&o.ctx.listener?(n="number"!=typeof n?o._pos[1]:n,t="number"!=typeof t?o._pos[2]:t,"number"!=typeof e?o._pos:(o._pos=[e,n,t],o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]),o)):o},HowlerGlobal.prototype.orientation=function(e,n,t,o,r,i){var a=this;if(!a.ctx||!a.ctx.listener)return a;var p=a._orientation;return n="number"!=typeof n?p[1]:n,t="number"!=typeof t?p[2]:t,o="number"!=typeof o?p[3]:o,r="number"!=typeof r?p[4]:r,i="number"!=typeof i?p[5]:i,"number"!=typeof e?p:(a._orientation=[e,n,t,o,r,i],a.ctx.listener.setOrientation(e,n,t,o,r,i),a)},Howl.prototype.init=function(e){return function(n){var t=this;return t._orientation=n.orientation||[1,0,0],t._stereo=n.stereo||null,t._pos=n.pos||null,t._pannerAttr={coneInnerAngle:"undefined"!=typeof n.coneInnerAngle?n.coneInnerAngle:360,coneOuterAngle:"undefined"!=typeof n.coneOuterAngle?n.coneOuterAngle:360,coneOuterGain:"undefined"!=typeof n.coneOuterGain?n.coneOuterGain:0,distanceModel:"undefined"!=typeof n.distanceModel?n.distanceModel:"inverse",maxDistance:"undefined"!=typeof n.maxDistance?n.maxDistance:1e4,panningModel:"undefined"!=typeof n.panningModel?n.panningModel:"HRTF",refDistance:"undefined"!=typeof n.refDistance?n.refDistance:1,rolloffFactor:"undefined"!=typeof n.rolloffFactor?n.rolloffFactor:1},t._onstereo=n.onstereo?[{fn:n.onstereo}]:[],t._onpos=n.onpos?[{fn:n.onpos}]:[],t._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(n,t){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"stereo",action:function(){o.stereo(n,t)}}),o;var r="undefined"==typeof Howler.ctx.createStereoPanner?"spatial":"stereo";if("undefined"==typeof t){if("number"!=typeof n)return o._stereo;o._stereo=n,o._pos=[n,0,0]}for(var i=o._getSoundIds(t),a=0;a<i.length;a++){var p=o._soundById(i[a]);if(p){if("number"!=typeof n)return p._stereo;p._stereo=n,p._pos=[n,0,0],p._node&&(p._pannerAttr.panningModel="equalpower",p._panner&&p._panner.pan||e(p,r),"spatial"===r?p._panner.setPosition(n,0,0):p._panner.pan.value=n),o._emit("stereo",p._id)}}return o},Howl.prototype.pos=function(n,t,o,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(n,t,o,r)}}),i;if(t="number"!=typeof t?0:t,o="number"!=typeof o?-.5:o,"undefined"==typeof r){if("number"!=typeof n)return i._pos;i._pos=[n,t,o]}for(var a=i._getSoundIds(r),p=0;p<a.length;p++){var f=i._soundById(a[p]);if(f){if("number"!=typeof n)return f._pos;f._pos=[n,t,o],f._node&&(f._panner&&!f._panner.pan||e(f,"spatial"),f._panner.setPosition(n,t,o)),i._emit("pos",f._id)}}return i},Howl.prototype.orientation=function(n,t,o,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(n,t,o,r)}}),i;if(t="number"!=typeof t?i._orientation[1]:t,o="number"!=typeof o?i._orientation[2]:o,"undefined"==typeof r){if("number"!=typeof n)return i._orientation;i._orientation=[n,t,o]}for(var a=i._getSoundIds(r),p=0;p<a.length;p++){var f=i._soundById(a[p]);if(f){if("number"!=typeof n)return f._orientation;f._orientation=[n,t,o],f._node&&(f._panner||(f._pos||(f._pos=i._pos||[0,0,-.5]),e(f,"spatial")),f._panner.setOrientation(n,t,o)),i._emit("orientation",f._id)}}return i},Howl.prototype.pannerAttr=function(){var n,t,o,r=this,i=arguments;if(!r._webAudio)return r;if(0===i.length)return r._pannerAttr;if(1===i.length){if("object"!=typeof i[0])return o=r._soundById(parseInt(i[0],10)),o?o._pannerAttr:r._pannerAttr;n=i[0],"undefined"==typeof t&&(r._pannerAttr={coneInnerAngle:"undefined"!=typeof n.coneInnerAngle?n.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:"undefined"!=typeof n.coneOuterAngle?n.coneOuterAngle:r._coneOuterAngle,coneOuterGain:"undefined"!=typeof n.coneOuterGain?n.coneOuterGain:r._coneOuterGain,distanceModel:"undefined"!=typeof n.distanceModel?n.distanceModel:r._distanceModel,maxDistance:"undefined"!=typeof n.maxDistance?n.maxDistance:r._maxDistance,panningModel:"undefined"!=typeof n.panningModel?n.panningModel:r._panningModel,refDistance:"undefined"!=typeof n.refDistance?n.refDistance:r._refDistance,rolloffFactor:"undefined"!=typeof n.rolloffFactor?n.rolloffFactor:r._rolloffFactor})}else 2===i.length&&(n=i[0],t=parseInt(i[1],10));for(var a=r._getSoundIds(t),p=0;p<a.length;p++)if(o=r._soundById(a[p])){var f=o._pannerAttr;f={coneInnerAngle:"undefined"!=typeof n.coneInnerAngle?n.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:"undefined"!=typeof n.coneOuterAngle?n.coneOuterAngle:f.coneOuterAngle,coneOuterGain:"undefined"!=typeof n.coneOuterGain?n.coneOuterGain:f.coneOuterGain,distanceModel:"undefined"!=typeof n.distanceModel?n.distanceModel:f.distanceModel,maxDistance:"undefined"!=typeof n.maxDistance?n.maxDistance:f.maxDistance,panningModel:"undefined"!=typeof n.panningModel?n.panningModel:f.panningModel,refDistance:"undefined"!=typeof n.refDistance?n.refDistance:f.refDistance,rolloffFactor:"undefined"!=typeof n.rolloffFactor?n.rolloffFactor:f.rolloffFactor};var s=o._panner;s?(s.coneInnerAngle=f.coneInnerAngle,s.coneOuterAngle=f.coneOuterAngle,s.coneOuterGain=f.coneOuterGain,s.distanceModel=f.distanceModel,s.maxDistance=f.maxDistance,s.panningModel=f.panningModel,s.refDistance=f.refDistance,s.rolloffFactor=f.rolloffFactor):(o._pos||(o._pos=r._pos||[0,0,-.5]),e(o,"spatial"))}return r},Sound.prototype.init=function(e){return function(){var n=this,t=n._parent;n._orientation=t._orientation,n._stereo=t._stereo,n._pos=t._pos,n._pannerAttr=t._pannerAttr,e.call(this),n._stereo?t.stereo(n._stereo):n._pos&&t.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var n=this,t=n._parent;return n._orientation=t._orientation,n._pos=t._pos,n._pannerAttr=t._pannerAttr,e.call(this)}}(Sound.prototype.reset);var e=function(e,n){n=n||"spatial","spatial"===n?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.value=e._stereo),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id)}}();var SoundPool=function(a,b,c){this.queue=[];this.limit=void 0===a?10:a;this.volume=void 0===b?5:b;this.clearRate=void 0===c?0:c;this.framesToClear=0;this.addSound=function(a){this.queue.length>=this.limit||this.queue.push(a)};this.playQueue=function(){if(0<this.framesToClear)this.framesToClear--;else for(;0<this.queue.length;)vol=void 0!=this.queue[0].volumeFilter?this.volume*this.queue[0].volumeFilter/10:this.volume/10,this.queue[0].volume(vol),this.queue[0].play(),this.queue.splice(0,1),this.framesToClear=
this.clearRate};this.setVolume=function(a){this.volume=a};this.decreaseVolume=function(){0<this.volume&&(--this.volume,this.volume=Math.round(100*this.volume)/100)};this.increaseVolume=function(){10>this.volume&&(this.volume+=1,this.volume=Math.round(100*this.volume)/100)};this.ignoreQueue=function(a){vol=this.volume/10;a.volume(vol);a.play()};this.display=function(a,b,c){c=void 0===c?"14px Arial":c;ctx.beginPath();ctx.font=c;ctx.fillStyle=a;ctx.fillText("Volume: "+this.volume,b.x,b.y)}};
function increaseMusicVolume(a){1>a.volume&&(vol=10*a.volume,vol+=1,vol=Math.round(vol)/10,a.volume=vol)}function decreaseMusicVolume(a){0<a.volume&&(vol=10*a.volume,--vol,vol=Math.round(vol)/10,a.volume=vol)}
var SoundArray=function(){this.timeOutArray=[];this.timeOutId=0;this.play=function(){this.timeOutArray[this.timeOutId].currentTime=0;this.timeOutArray[this.timeOutId].play();this.timeOutId++;this.timeOutId%=this.timeOutLimit};this.timeOutLimit=3;this.loadSounds=function(a){for(var b=0;b<this.timeOutLimit;b++){var c=document.createElement("audio");c.src=a.src;c.volume=a.volume;this.timeOutArray[b]=c}};this.updateVolume=function(a){if(null!=this.sound)for(var b=0;b<this.timeOutLimit;b++)this.timeOutArray[b].volume=
a}},BufferedSound=function(a,b,c,d){this.sound=a;this.buffer=b;this.upperBound=void 0===c?3:c;this.lowerBound=void 0===d?.5:d;this.playSound2=function(){if(0==this.sound.currentTime&&0==this.buffer.currentTime)this.sound.play();else{var a=this.lowerBound-.1;this.sound.currentTime>this.upperBound&&this.buffer.play();this.buffer.currentTime>this.lowerBound&&this.buffer.currentTime<this.upperBound&&(this.sound.pause(),this.sound.currentTime=a);this.buffer.currentTime>this.upperBound&&this.sound.play();
this.sound.currentTime>this.lowerBound&&this.sound.currentTime<this.upperBound&&(this.buffer.pause(),this.buffer.currentTime=a);console.log(this.sound.currentTime,this.buffer.currentTime)}};this.playSound=function(){null!=this.sound&&null!=this.buffer&&(this.sound.play(),this.buffer.play())};this.stopSound=function(){null!=this.sound&&null!=this.buffer&&(this.sound.pause(),this.sound.currentTime=0,this.buffer.pause(),this.buffer.currentTime=0)};this.pauseSound=function(){null!=this.sound&&null!=this.buffer&&
(this.sound.pause(),this.buffer.pause())}},maxSounds=1,startingVolume=5;soundPool=new SoundPool(maxSounds,startingVolume);
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,d,e){if(b){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var g=a[e];g in d||(d[g]={});d=d[g]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,d,e){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==e||e>b)e=b;e=Number(e);0>e&&(e=Math.max(0,b+e));for(d=Number(d||0);d<e;d++)this[d]=a;return this}},"es6-impl","es3");
var c=document.getElementById("umCanvas"),ctx=c.getContext("2d"),globalID=0,gradualRate=1;Intersecction=function(a,b){this.overlap=a;this.contains=b};MTV=function(a,b,d){this.axis=a;this.magnitude=b;this.contains=d};Versor=function(a,b){this.x=a;this.y=b};Point=function(a,b){this.x=a;this.y=b};Vector=function(a,b){this.x=a;this.y=b};Projection=function(a,b){this.min=a;this.max=b};function distance(a,b){var d=a.x-b.x,e=a.y-b.y;return Math.sqrt(d*d+e*e)}
function calculateVector(a,b,d){d.x=a.x-b.x;d.y=a.y-b.y}function norm(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function radiansToDegrees(a){return 180*a/Math.PI}function degreesToRadians(a){return a*Math.PI/180}function angleVectors(a,b){unitA=new Vector(0,0);unitB=new Vector(0,0);unitVector(a,unitA);unitVector(b,unitB);var d=dotProduct(unitA,unitB);return Math.acos(d)}function normalVector1(a,b,d){x=a.x-b.x;y=a.y-b.y;d.x=-y;d.y=x}function normalVector2(a,b,d){x=a.x-b.x;y=a.y-b.y;d.x=y;d.y=-x}
function unitVector(a,b){var d=norm(a);0!=d?(b.x=a.x/d,b.y=a.y/d):(b.x=0,b.y=0)}function dotProduct(a,b){return a.x*b.x+a.y*b.y}function projection(a,b){min=99999;max=-99999;for(var d,e=0;e<a.length;e++)d=dotProduct(a[e],b),d>max&&(max=d),d<min&&(min=d);return new Projection(min,max)}function projectionCircle(a,b){var d;d=dotProduct(a.position,b);min=d-a.radius;max=d+a.radius;return new Projection(min,max)}
function collisionCircles(a,b){var d=distance(a.position,b.position),e=d-(a.radius+b.radius),g=!1;if(0>e){var f=a.radius;b.radius>f&&(f=b.radius);f>d&&(g=!0);a.findAxis(b.position);unitVector(a.axis,a.axis);return new MTV(new Vector(a.axis.x,a.axis.y),-e,g)}return!1}
function circleSTA(a,b){dist=1E4;closest=-1;for(var d=0;d<b.vertices.length;d++)aux=distance(a.position,b.vertices[d]),aux<dist&&(dist=aux,closest=d);a.findAxis(b.vertices[closest]);unitVector(a.axis,a.axis);var e=projectionCircle(a,a.axis),g=projection(b.vertices,a.axis),f=999999,h=!1;intersect=overlap(e,g);if(0==intersect.overlap)return!1;intersect.overlap<f&&(f=intersect.overlap,smallestAxis=a.axis,h=intersect.contains);for(d=0;d<b.axes.length;d++){e=projectionCircle(a,b.axes[d]);g=projection(b.vertices,
b.axes[d]);intersect=overlap(e,g);if(0==intersect.overlap)return!1;intersect.overlap<f&&(f=intersect.overlap,smallestAxis=b.axes[d],h=intersect.contains)}distance(a.position,b.center)<a.radius&&(h=!0);b.hit=!0;a.hit=!0;return new MTV(new Vector(a.axis.x,a.axis.y),f,h)}
function collisionSTA(a,b){if(1==a.sides&&1==b.sides)return collisionCircles(a,b);if(1==a.sides)return circleSTA(a,b);if(1==b.sides)return circleSTA(b,a);for(var d=999999,e=null,g=!1,f=0;f<a.axes.length;f++){projA=projection(a.vertices,a.axes[f]);projB=projection(b.vertices,a.axes[f]);intersect=overlap(projA,projB);if(0==intersect.overlap)return!1;intersect.overlap<d&&(d=intersect.overlap,e=a.axes[f],g=intersect.contains)}for(f=0;f<b.axes.length;f++){projA=projection(a.vertices,b.axes[f]);projB=projection(b.vertices,
b.axes[f]);intersect=overlap(projA,projB);if(0==intersect.overlap)return!1;intersect.overlap<d&&(d=intersect.overlap,e=b.axes[f],g=intersect.contains)}a.hit=!0;b.hit=!0;return new MTV(new Vector(e.x,e.y),d,g)}
function debugSTA(a,b){if(1==a.sides&&1==b.sides)return collisionCircles(a,b);if(1==a.sides)return circleSTA(a,b);if(1==b.sides)return circleSTA(b,a);var d=999999,e=null,g=!1;colorA="#FF0000";colorB="#0000FF";overlaps=[];var f;new Intersecction;for(var h=0;h<a.axes.length;h++){projA=projection(a.vertices,a.axes[h]);projB=projection(b.vertices,a.axes[h]);drawProjection(projA,a.axes[h],colorA);drawProjection(projB,a.axes[h],colorB);f=overlap(projA,projB);overlaps.push(f.overlap);if(0==f.overlap)return console.log(overlaps),
!1;f.overlap<d&&(d=f.overlap,e=a.axes[h],g=f.contains)}for(h=0;h<b.axes.length;h++){projA=projection(a.vertices,b.axes[h]);projB=projection(b.vertices,b.axes[h]);drawProjection(projA,b.axes[h],colorA);drawProjection(projB,b.axes[h],colorB);f=overlap(projA,projB);overlaps.push(f.overlap);if(0==f.overlap)return console.log(overlaps),!1;f.overlap<d&&(d=f.overlap,e=b.axes[h],g=f.contains)}console.log(overlaps);a.hit=!0;b.hit=!0;return new MTV(new Vector(e.x,e.y),d,g)}
function overlap(a,b){var d=new Intersecction(0,!1);if(b.min<a.max&&b.max>a.max)d.overlap=b.min-a.max;else if(b.max>a.min&&b.min<a.min)d.overlap=a.min-b.max;else if(b.min>a.min&&b.max<a.max){d.overlap=a.max-b.max;var e=Math.abs(a.min-b.min),g=Math.abs(a.max-b.max);d.overlap=e<g?d.overlap+e:d.overlap+g;d.contains=!0}return d}
function rotatePolygon(a,b){b=degreesToRadians(b);if(1!=a.sides)for(i=0;i<a.vertices.length;i++)a.vertices[i].x-=a.center.x,a.vertices[i].y-=a.center.y,x=a.vertices[i].x*Math.cos(b)-a.vertices[i].y*Math.sin(b),y=a.vertices[i].x*Math.sin(b)+a.vertices[i].y*Math.cos(b),a.vertices[i].x=x+a.center.x,a.vertices[i].y=y+a.center.y}var angle=1*Math.PI/180,cos=Math.cos(angle),sin=Math.sin(angle);
function simpleRotate(a){for(i=0;i<a.vertices.length;i++)a.vertices[i].x-=a.center.x,a.vertices[i].y-=a.center.y,x=a.vertices[i].x*cos-a.vertices[i].y*sin,y=a.vertices[i].x*sin+a.vertices[i].y*cos,a.vertices[i].x=x+a.center.x,a.vertices[i].y=y+a.center.y}function listToVertices(a){vertices=[];0!=a.length%2&&console.log("Error: list is not a valid set of coordinates.");for(var b=0;b<a.length;b+=2)this.vertices[b/2]=new Point(a[b],a[b+1]);return vertices}function times2(a){return 2*a}
function drawProjection(a,b,d){d=void 0===d?"#000000":d;ctx.save();ctx.beginPath();0>b.x&&0>b.y?ctx.translate(c.width,c.height):0>b.x?ctx.translate(c.width,0):0>b.y&&ctx.translate(0,c.height);ctx.lineWidth=12;ctx.strokeStyle=d;d=new Point(a.min*b.x,a.min*b.y);a=new Point(a.max*b.x,a.max*b.y);ctx.moveTo(d.x,d.y);ctx.lineTo(a.x,a.y);ctx.stroke();ctx.restore()}
function drawCircle(a,b,d,e,g){b=void 0===b?"#0000FF":b;d=void 0===d?"#FF0000":d;e=void 0===e?!1:e;g=void 0===g?"#00F0FF":g;ctx.save();ctx.beginPath();ctx.strokeStyle=1==a.hit?d:b;ctx.arc(a.position.x,a.position.y,a.radius,0,2*Math.PI);ctx.stroke();e&&(ctx.fillStyle=g,ctx.beginPath(),ctx.arc(a.position.x,a.position.y,3,0,2*Math.PI),ctx.fill());ctx.restore()}
function drawPolygon(a,b,d,e,g,f,h){b=void 0===b?"#0000FF":b;d=void 0===d?"#FF0000":d;e=void 0===e?!0:e;g=void 0===g?!0:g;f=void 0===f?"#00F0FF":f;h=void 0===h?"#0000FF":h;ctx.save();ctx.beginPath();ctx.strokeStyle=1==a.hit?d:b;ctx.moveTo(a.vertices[0].x,a.vertices[0].y);for(b=0;b<a.vertices.length;b++)ctx.lineTo(a.vertices[b].x,a.vertices[b].y);ctx.lineTo(a.vertices[0].x,a.vertices[0].y);ctx.stroke();ctx.fillStyle=h;if(e)for(b=0;b<a.vertices.length;b++)ctx.beginPath(),ctx.arc(a.vertices[b].x,a.vertices[b].y,
3,0,2*Math.PI),ctx.fill();g&&void 0!=a.center&&(ctx.fillStyle=f,ctx.beginPath(),ctx.arc(a.center.x,a.center.y,3,0,2*Math.PI),ctx.fill());ctx.restore()}midPoint=function(a,b){vector=new Vector(0,0);calculateVector(a,b,vector);vector.x*=.5;vector.y*=.5;this.x=a.x-vector.x;this.y=a.y-vector.y};function drawVector(a,b){ctx.beginPath();ctx.strokeStyle="#00FF00";ctx.moveTo(a.x,a.y);ctx.lineTo(a.x+b.x,a.y+b.y);ctx.stroke()}
function calculateAxes(a){if(1!=a.sides){if(4==a.sides){for(var b=0;b<a.vertices.length-1;b++)normalVector1(a.vertices[b],a.vertices[b+1],a.axes[b]),unitVector(a.axes[b],a.axes[b]);normalVector1(a.vertices[b],a.vertices[0],a.axes[b])}else{for(b=0;b<a.vertices.length-1;b++)normalVector2(a.vertices[b],a.vertices[b+1],a.axes[b]),unitVector(a.axes[b],a.axes[b]);normalVector2(a.vertices[b],a.vertices[0],a.axes[b])}unitVector(a.axes[b],a.axes[b])}}
function drawAxes(a,b){var d=new Vector(0,0);if(1!=a.sides){for(var e=0;e<a.vertices.length-1;e++){var g=new midPoint(a.vertices[e],a.vertices[e+1]);d.x=a.axes[e].x*b;d.y=a.axes[e].y*b;drawVector(g,d)}g=new midPoint(a.vertices[e],a.vertices[0]);d.x=a.axes[e].x*b;d.y=a.axes[e].y*b;drawVector(g,d)}}function drawFPS(a,b){b=void 0===b?"#000FFF":b;ctx.beginPath();ctx.fillStyle=b;ctx.font="14px Arial";string="FPS: "+a;ctx.fillText(string,10,20);ctx.stroke()}
function applyGradualVector(a,b){if(0==a.gradualVector.x&&0==a.gradualVector.y)a.colliding=!1;else if(norm(a.gradualVector)<=b)a.applyVector(a.gradualVector),a.gradualVector.x=0,a.gradualVector.y=0,a.colliding=!1;else{var d=new Vector(0,0);unitVector(a.gradualVector,d);d.x*=b;d.y*=b;a.gradualVector.x-=d.x;a.gradualVector.y-=d.y;a.applyVector(d)}}
var Rect=function(a,b,d,e,g,f,h,k){var l=[];l.push(a);l.push(b);l.push(a+d);l.push(b);l.push(a+d);l.push(b+e);l.push(a);l.push(b+e);this.vertices=listToVertices(l);this.position=new Point(a,b);this.width=d;this.height=e;this.mass=d*e;this.center=new Point(a+d/2,b+e/2);this.colliding=this.hit=!1;this.versor=new Versor(g,f);this.velocity=h;this.spin=k;this.sides=4;this.axes=[];this.projections=[];this.gradualVector=new Vector(0,0);for(a=this.gradualID=0;a<this.sides;a++)this.axes[a]=new Vector(0,0),
this.projections[a]=new Projection(0,0);this.applyVector=function(a){for(var b=0;b<this.vertices.length;b++)this.vertices[b].x+=a.x,this.vertices[b].y+=a.y;this.position.x+=a.x;this.position.y+=a.y;this.center.x=this.position.x+.5*this.width;this.center.y=this.position.y+.5*this.height};this.update=function(){this.applyGradualVector(gradualRate);xIncrement=this.versor.x*this.velocity;yIncrement=this.versor.y*this.velocity;incrementVertices(this.vertices,xIncrement,yIncrement);incrementRect(this,xIncrement,
yIncrement);this.hit=!1};this.moveTo=function(a){var b=new Vector(0,0);calculateVector(a,this.center,b);this.applyVector(b)};this.applyGradualVector=function(){applyGradualVector(this,gradualRate)}},Triangle=function(a,b,d,e,g,f,h){var k=[];k.push(a);k.push(b);k.push(a+d);k.push(b);k.push(a+.5*d);k.push(b-d);this.vertices=listToVertices(k);this.position=new Point(a,b);this.side=d;this.mass=d*d*.5;this.center=new Point(a+d/2,b-d/3);this.colliding=this.hit=!1;this.versor=new Versor(e,g);this.velocity=
f;this.spin=h;this.sides=3;this.gradualVector=new Vector(0,0);this.gradualID=0;this.axes=[];this.projections=[];for(a=0;a<this.sides;a++)this.axes[a]=new Vector(0,0),this.projections[a]=new Projection(0,0);this.applyVector=function(a){for(var b=0;b<this.vertices.length;b++)this.vertices[b].x+=a.x,this.vertices[b].y+=a.y};this.update=function(){this.applyGradualVector(gradualRate);xIncrement=this.versor.x*this.velocity;yIncrement=this.versor.y*this.velocity;incrementVertices(this.vertices,xIncrement,
yIncrement);for(var a=0,b=0,d=0;d<this.vertices.length;d++)a+=this.vertices[d].x,b+=this.vertices[d].y;this.center.x=a/3;this.center.y=b/3;this.hit=!1};this.moveTo=function(a){var b=new Vector(0,0);calculateVector(a,this.center,b);this.applyVector(b)};this.applyGradualVector=function(){applyGradualVector(this,gradualRate)}};function incrementVertices(a,b,d){for(var e=0;e<a.length;e++)a[e].x+=b,a[e].y+=d}
function incrementRect(a,b,d){a.position.x+=b;a.position.y+=d;a.center.x=a.position.x+.5*a.width;a.center.y=a.position.y+.5*a.height}
var Circle=function(a,b,d,e,g,f,h){var k=[];k.push(a);k.push(b);this.position=new Point(a,b);this.radius=d;this.mass=d*d;this.colliding=this.hit=!1;this.versor=new Versor(e,g);this.velocity=f;this.spin=h;this.sides=1;this.axis=new Vector(0,0);this.projections=[];this.gradualVector=new Vector(0,0);this.gradualID=0;this.applyVector=function(a){this.position.x+=a.x;this.position.y+=a.y};this.update=function(){this.applyGradualVector(gradualRate);xIncrement=this.versor.x*this.velocity;yIncrement=this.versor.y*
this.velocity;this.position.x+=xIncrement;this.position.y+=yIncrement;this.hit=!1};this.findAxis=function(a){calculateVector(this.position,a,this.axis)};this.moveTo=function(a){var b=new Vector(0,0);calculateVector(a,this.position,b);this.applyVector(b)};this.applyGradualVector=function(){applyGradualVector(this,gradualRate)}};
function checkBorderCircle(a,b){rightBound=a.position.x+a.radius;leftBound=a.position.x-a.radius;lowerBound=a.position.y+a.radius;upperBound=a.position.y-a.radius;var d=!1;rightBound>c.width?(diff=new Vector(-(rightBound-c.width),0),a.applyVector(diff),a.versor.x*=-1,void 0!=b&&b(axis="x"),d=!0):0>leftBound?(diff=new Vector(-leftBound,0),a.applyVector(diff),a.versor.x*=-1,void 0!=b&&b(axis="x"),d=!0):lowerBound>c.height?(diff=new Vector(0,-(lowerBound-c.height)),a.applyVector(diff),a.versor.y*=-1,
void 0!=b&&b(axis="y"),d=!0):0>upperBound&&(diff=new Vector(0,-upperBound),a.applyVector(diff),a.versor.y*=-1,void 0!=b&&b(axis="y"),d=!0);return d}
function checkBorder(a,b){if(1==a.sides)checkBorderCircle(a,b);else return yAxis=new Vector(0,1),xAxis=new Vector(1,0),projX=projection(a.vertices,xAxis),projY=projection(a.vertices,yAxis),hit=!1,projX.max>c.width?(a.versor.x*=-1,diff=new Vector(-(projX.max-c.width),0),a.applyVector(diff),void 0!=b&&b(axis="x"),hit=!0):0>projX.min&&(a.versor.x*=-1,diff=new Vector(-projX.min,0),a.applyVector(diff),void 0!=b&&b(axis="x"),hit=!0),projY.max>c.height&&(a.versor.y*=-1,diff=new Vector(0,-(projY.max-c.height)),
a.applyVector(diff),void 0!=b&&b(axis="y"),hit=!0),0>projY.min&&(a.versor.y*=-1,diff=new Vector(0,-projY.min),a.applyVector(diff),void 0!=b&&b(axis="y"),hit=!0),hit}function changeDirection(a,b){a.versor.x=b.x;a.versor.y=b.y}function smartCollision(a,b,d){if(void 0!=a&&void 0!=b){var e=a.mass-b.mass,e=Math.abs(e);smaller=Math.min(a.mass,b.mass);hit=e<4*smaller?nullForceCollision(a,b):unilateralElasticCollision(a,b);void 0!=d&&hit&&d()}}
function nullForceCollision(a,b){return 0==collisionSTA(a,b)?!1:!0}function unilateralElasticCollision(a,b){var d=collisionSTA(a,b);if(0==d)return!1;a.mass>b.mass?(d.axis.x=-d.axis.x,d.axis.y=-d.axis.y,changeDirection(b,d.axis)):changeDirection(a,d.axis);return!0}
function elasticCollision(a,b,d,e,g){if(1!=a.colliding||1!=b.colliding||a.gradualID!=b.gradualID){var f=collisionSTA(a,b);if(0==f)return!1;g=10;globalID++;a.colliding=!0;b.colliding=!0;a.gradualID=globalID;b.gradualID=globalID;var h=new Vector(0,0);h.x=f.axis.x*f.magnitude;h.y=f.axis.y*f.magnitude;b.gradualVector=h;applyGradualVector(b,g);if(void 0!=e)for(var k=0;k<e.length;k++)e[k].gradualVector=h,applyGradualVector(e[k],g),e[k].colliding=!0;vect=new Vector(0,0);vect.x=-1*h.x;vect.y=-1*h.y;a.gradualVector=
vect;applyGradualVector(a,g);if(void 0!=d)for(k=0;k<d.length;k++)vect=new Vector(0,0),vect.x=-1*h.x,vect.y=-1*h.y,d[k].gradualVector=vect,applyGradualVector(d[k],g),d[k].colliding=!0;changeDirection(a,f.axis);f.axis.x=-f.axis.x;f.axis.y=-f.axis.y;changeDirection(b,f.axis);return!0}}function checkElasticCollisionsNaive(a,b){var d,e;for(d=0;d<a.length;d++)for(e=d+1;e<a.length;e++)elasticCollision(a[e],a[d],void 0,void 0,b)}
function checkColisionsNaive(a){var b,d;for(b=0;b<a.length;b++)for(d=b+1;d<a.length;d++)smartCollision(a[d],a[b])}function smallest(a,b){return a<=b?a:b}Fps=function(){this.index=0;this.array=[];this.maxSize=24;this.add=function(a){this.array[this.index]=1E3/a;this.index=(this.index+1)%this.maxSize};this.mean=0;this.calculateMean=function(){for(var a=0,b=0;b<this.array.length;b++)a+=this.array[b];this.mean=Math.round(a/this.array.length)}};
function randomRect(a,b,d,e){var g=Math.ceil(Math.random()*c.width/2)+a,f=Math.ceil(Math.random()*c.height/2)+a,h=Math.ceil(Math.random()*a)+b;a=Math.ceil(Math.random()*a)+b;b=Math.round(Math.random()+1);b=Math.pow(-1,b);return rect=new Rect(g,f,h,a,Math.random(),Math.random(),d,Math.ceil(Math.random()*e*b))}
function randomTriangle(a,b,d,e){var g=Math.ceil(Math.random()*c.width/2)+a,f=Math.ceil(Math.random()*c.height/2)+a;a=Math.ceil(Math.random()*a)+b;b=Math.round(Math.random()+1);b=Math.pow(-1,b);return triangle=new Triangle(g,f,a,Math.random(),Math.random(),d,Math.ceil(Math.random()*e*b))}
function randomCircle(a,b,d,e){var g=Math.ceil(Math.random()*c.width/2)+a,f=Math.ceil(Math.random()*c.height/2)+a;a=Math.ceil(Math.random()*a)+b;b=Math.round(Math.random()+1);b=Math.pow(-1,b);return circle=new Circle(g,f,a,Math.random(),Math.random(),d,Math.ceil(Math.random()*e*b))};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6-impl","es3");
var Explosive=function(a,b,c){this.damage=a;this.expansionRate=b;this.maxRadius=c},Explosion=function(a,b,c,d,e,f,g){c=void 0===c?10:c;d=void 0===d?5:d;e=void 0===e?50:e;this.color=void 0===g?"#FF0000":g;this.hitbox=new Circle(a,b,void 0===f?1:f,0,0,0,0);this.hitbox.mass=1E5;this.expansionRate=d;this.maxRadius=e;this.duration=e/d;this.finished=!1;this.damageMultiplier=c;this.expandRadius=function(){this.hitbox.radius<this.maxRadius&&(this.hitbox.radius+=this.expansionRate)};this.decreaseDuration=
function(){this.duration--;0==this.duration&&(this.finished=!0)};this.draw=function(){ctx.beginPath();ctx.fillStyle=this.color;ctx.arc(this.hitbox.position.x,this.hitbox.position.y,this.hitbox.radius,0,2*Math.PI);ctx.fill()};this.fetchDamage=function(a){a=this.hitbox.radius-distance(a.center,this.hitbox.position);a*=this.damageMultiplier;return a=Math.round(Math.abs(a))}};function finishExplosions(a){for(var b=0;b<a.length;b++)a[b].finished&&a.splice(b,1)}
function updateExplosions(a){for(var b=0;b<a.length;b++)a[b].expandRadius(),a[b].decreaseDuration()};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,e,f){if(b){e=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var g=a[f];g in e||(e[g]={});e=e[g]}a=a[a.length-1];f=e[a];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,a,f){var e=this.length||0;0>a&&(a=Math.max(0,e+a));if(null==f||f>e)f=e;f=Number(f);0>f&&(f=Math.max(0,e+f));for(a=Number(a||0);a<f;a++)this[a]=b;return this}},"es6-impl","es3");
var Phases=function(){this.phase6=this.phase5=this.phase4=this.phase3=this.phase2=this.phase1=!1;this.current=0},TargetSystem=function(){this.currentTarget=void 0;this.index=0;this.possibleTargets=[];this.cursor=new Cursor("#00FF00");this.cursor.dash=8;this.cursor.spin=1;this.color="#00FF00";this.distance=0;this.predictedPath=[];this.autoFiring=this.autoAiming=!1;this.refreshIndex=this.refreshRate=this.shipVelocity=0;this.updateRefresh=function(){this.refreshIndex++;this.refreshIndex%=this.refreshRate};
this.setPossibleTargets=function(a){this.possibleTargets=a};this.analyseTarget=function(a){0!=this.possibleTargets.length&&((void 0==this.currentTarget||this.currentTarget.dead)&&this.changeTarget(),this.distance=distance(a,this.currentTarget.hitbox.center),this.velocity=Math.round(this.currentTarget.hitbox.velocity),this.direction=this.currentTarget.inertiaVector)};this.aimAssist=function(a,b){if(0!=this.possibleTargets.length){this.shipVelocity=velocity;this.inRange=!1;for(var e=0;e<a.length;e++){var f=
a[e].projectileVelocity;this.distance=distance(a[e].position,this.currentTarget.hitbox.center);this.distance=Math.round(this.distance);this.travelTime=this.distance/(f+b);this.distance<a[e].range+b&&(this.inRange=!0);predictedPath=new Point(0,0);predictedPath.x=this.currentTarget.hitbox.center.x+this.direction.x*this.travelTime;predictedPath.y=this.currentTarget.hitbox.center.y+this.direction.y*this.travelTime;this.predictedPath.push(predictedPath)}}};this.clearAimAssist=function(){this.predictedPath=
[]};this.changeTarget=function(){0!=this.possibleTargets.length&&(this.index++,this.index%=this.possibleTargets.length,this.currentTarget=this.possibleTargets[this.index])};this.displayInfo=function(){if(void 0!=this.currentTarget&&!this.currentTarget.dead){ctx.beginPath();ctx.fillStyle=this.color;var a="Target:   "+this.currentTarget.name+(this.index+1);ctx.fillText(a,c.width/2-50,40);this.inRange||(ctx.fillStyle="#FF0000");a="Distance: "+this.distance;ctx.fillText(a,c.width/2-50,60)}};this.drawAid=
function(a){void 0==this.currentTarget||this.currentTarget.dead||(this.cursor.setPoint(this.currentTarget.hitbox.center),this.cursor.radius=this.currentTarget.hitbox.side+5,this.cursor.draw(),this.drawPredictedPath(a))};this.drawPredictedPath=function(a){for(var b=0;b<this.predictedPath.length;b++)a[b].enabled&&(this.cursor.color=this.inRange?"#00FF00":"#FF0000",this.cursor.setPoint(this.predictedPath[b]),this.cursor.radius=3,this.cursor.draw())};this.setAutoAim=function(a,b){this.autoAiming=a;if(!a)for(var e=
0;e<b.length;e++)b[e].turret&&b[e].setCenter(coord)};this.autoAim=function(a){if(this.autoAiming)if(void 0==this.currentTarget||0==this.possibleTargets.length){for(var b=0;b<a.length;b++)a[b].turret&&a[b].setCenter(coord);if(this.autoFiring)for(this.autoFiring=!1,b=0;b<a.length;b++)a[b].firing=!1}else for(this.autoFiring=!0,b=0;b<a.length;b++)a[b].turret&&a[b].setCenter(this.predictedPath[b])};this.autoFire=function(a){if(this.autoFiring&&this.autoAiming)for(var b=0;b<a.length;b++)a[b].turret&&(a[b].firing=
this.distance<a[b].range?!0:!1)}},EnergySource=function(a,b,e){e=void 0===e?500:e;this.current=this.max=void 0===a?100:a;this.rechargeRate=void 0===b?10:b;this.rechargeSpeed=e;this.rechargeEvent=void 0;this.recharging=!0;this.getValue=function(){var a=this.max*this.rechargeRate,a=a/1E3*(1E3-e);return a=Math.round(a)};this.describe=function(){var a=[];a.push("Max points: "+this.max,"Recharge Rate: "+this.rechargeRate,"Recharge Speed: "+this.rechargeSpeed/1E3+" seconds");return a};this.recharge=function(a){this.recharging&&
(this.current<this.max&&(this.current+=this.rechargeRate,this.current>this.max&&(this.current=this.max),this.recharging=!1,this.rechargeEvent=void 0),void 0==this.rechargeEvent&&(this.rechargeEvent=setTimeout(function(){a.recharging=!0},a.rechargeSpeed)))};this.drain=function(a){this.current-=a;0>this.current&&(this.current=0)}},Shield=function(a,b,e,f,g){this.sound=null;this.enabled=!1;this.max=void 0===a?100:a;this.current=0;this.drainRate=void 0===e?10:e;this.rechargeEfficiency=void 0===f?.5:f;
this.drainSpeed=void 0===g?250:g;this.draining=!0;this.drainEvent=void 0;this.powerSupply=new EnergySource(0,0);this.resistance=0;this.resistanceType="f";this.getValue=function(){value=this.max*(this.resistance+1);value*=this.rechargeEfficiency;value*=1E3-this.drainSpeed;return value=Math.round(value/100)};this.describe=function(){var d=[];d.push("Max points: "+this.max,"Drain Rate: "+this.drainRate,"Recharge Efficiency: "+this.rechargeEfficiency,"Drain Speed: "+this.drainSpeed/1E3+" seconds","Resistance: "+
this.resistance);return d};this.setPowerSupply=function(d){this.powerSupply=d};this.setEnabled=function(d){this.enabled=d};this.drainEnergy=function(d){this.draining&&this.enabled&&(this.draining=!1,this.drainingEvent=void 0,void 0===this.drainingEvent&&(this.drainingEvent=setTimeout(function(){d.draining=!0},d.drainSpeed)),this.current<this.max&&(this.powerSupply.current>this.drainRate?(this.current+=this.drainRate*this.rechargeEfficiency,this.powerSupply.current-=this.drainRate):(this.current+=
this.powerSupply.current*this.rechargeEfficiency,this.powerSupply.current=0),this.current>this.max&&(this.current=this.max)))};this.sufferDamage=function(d){d="f"==this.resistanceType?d-this.resistance:d*this.resistance;0<d&&(this.current-=d);0>this.current?(d=-1*this.current,this.current=0):d=0;null!=this.sound&&soundPool.addSound(this.sound);return d}},Hull=function(a,b){b=void 0===b?0:b;this.sound=null;this.current=this.max=void 0===a?100:a;this.resistance=b;this.resistanceType="f";this.getValue=
function(){return value=this.max*(this.resistance+1)};this.describe=function(){var a=[];a.push("Max points: "+this.max,"Resistance: "+this.resistance);return a};this.sufferDamage=function(a){a="f"==this.resistanceType?a-b:a*b;0<a&&(this.current-=a);null!=this.sound&&soundPool.addSound(this.sound)};this.recover=function(a){this.current+=a;this.current>this.max&&(this.current=this.max)}},Ship=function(a,b,e,f,g){f=void 0===f?"#0000FF":f;g=void 0===g?"#00F0FF":g;this.hitbox=new Triangle(a,b,e,0,0,0,
0);this.primaryColor=f;this.secondaryColor=g;this.auxHitbox=new Triangle(a,b-e,e,0,0,0,0);this.powerSupply=new EnergySource(100,10);this.hull=new Hull;this.shield=new Shield;this.dead=this.immunity=!1;this.weapons=[];this.targetSystem=new TargetSystem;this.deadSound=this.engineSound=null;this.currentWeapon=0;this.isStrafing=this.isTurning=this.braking=this.reverseEngine=this.engineOn=this.lock=!1;this.strafingSide=0;this.acceleration=.125;this.maxSpeed=4;this.turnRate=3.5;this.turning=!1;this.rotate=
0;this.front=new Point(this.hitbox.vertices[2].x,this.hitbox.vertices[2].y);this.inertiaVector=new Vector(0,0);this.engineVersor=new Vector(0,0);this.engineVector=new Vector(0,0);this.strafingVector=new Vector(0,0);this.autoPath=new Point(0,0);this.getEngineValue=function(){var d=10*this.maxSpeed,d=d+1E3*this.acceleration,d=d+100*this.turnRate;return Math.round(d)};this.describeEngine=function(){var d=[];d.push("Max Speed: "+this.maxSpeed,"Acceleration : "+this.acceleration,"Turn Rate: "+this.turnRate);
return d};this.getValue=function(){for(var d=this.getEngineValue(),d=d+this.hull.getValue(),d=d+this.shield.getValue(),d=d+this.powerSupply.getValue(),a=0;a<this.weapons.length;a++)d+=this.weapons[a].getValue();return d};this.updateDirection=function(){if(this.engineOn||this.reverseEngineOn||0!=this.braking){this.inertiaVector.x=this.hitbox.versor.x*this.hitbox.velocity;this.inertiaVector.y=this.hitbox.versor.y*this.hitbox.velocity;this.engineOn?(calculateVector(this.front,this.hitbox.center,this.engineVersor),
unitVector(this.engineVersor,this.engineVersor),this.engineVector.x=this.engineVersor.x*this.acceleration,this.engineVector.y=this.engineVersor.y*this.acceleration,null!=this.engineSound&&(2<this.engineSound.currentTime&&(this.engineSound.currentTime=.1),this.engineSound.playSound2())):this.braking?(unitVector(this.inertiaVector,this.engineVersor),this.engineVersor.x*=-1,this.engineVersor.y*=-1,this.acceleration>this.hitbox.velocity?(this.engineVector.x=this.engineVersor.x*this.hitbox.velocity,this.engineVector.y=
this.engineVersor.y*this.hitbox.velocity):(this.engineVector.x=this.engineVersor.x*this.acceleration,this.engineVector.y=this.engineVersor.y*this.acceleration)):(calculateVector(this.front,this.hitbox.center,this.engineVersor),unitVector(this.engineVersor,this.engineVersor),this.reverseEngineOn&&(this.engineVersor.x*=-1,this.engineVersor.y*=-1,this.engineVector.x=this.engineVersor.x*this.acceleration,this.engineVector.y=this.engineVersor.y*this.acceleration));var d=new Vector(this.engineVector.x+
this.inertiaVector.x,this.engineVector.y+this.inertiaVector.y),a=norm(d);a<=this.maxSpeed?0==a?(this.hitbox.velocity=a,this.hitbox.versor.x=0,this.hitbox.versor.y=0):(unitVector(d,d),this.hitbox.velocity=a,this.hitbox.versor.x=d.x,this.hitbox.versor.y=d.y):(unitVector(d,d),this.hitbox.versor.x=d.x,this.hitbox.versor.y=d.y);this.auxHitbox.velocity=this.hitbox.velocity;this.auxHitbox.versor=this.hitbox.versor}else null!=this.engineSound&&this.engineSound.stopSound()};this.updatePosition=function(){this.hitbox.update();
this.auxHitbox.update();this.front.x=this.hitbox.vertices[2].x;this.front.y=this.hitbox.vertices[2].y};this.updateTurn=function(){if(this.isTurning){this.hitbox.spin=0;this.auxHitbox.spin=0;rotatePolygon(this.hitbox,this.rotate);theta=degreesToRadians(this.rotate);for(var d=0;d<this.auxHitbox.vertices.length;d++)this.auxHitbox.vertices[d].x-=this.hitbox.center.x,this.auxHitbox.vertices[d].y-=this.hitbox.center.y,a=this.auxHitbox.vertices[d].x*Math.cos(theta)-this.auxHitbox.vertices[d].y*Math.sin(theta),
b=this.auxHitbox.vertices[d].x*Math.sin(theta)+this.auxHitbox.vertices[d].y*Math.cos(theta),this.auxHitbox.vertices[d].x=a+this.hitbox.center.x,this.auxHitbox.vertices[d].y=b+this.hitbox.center.y}};this.turn=function(d,a){this.isTurning=a;this.rotate="l"==d?-this.turnRate:this.turnRate};this.updateStrafe=function(){if(this.isStrafing){this.inertiaVector.x=this.hitbox.versor.x*this.hitbox.velocity;this.inertiaVector.y=this.hitbox.versor.y*this.hitbox.velocity;var d=new midPoint(this.hitbox.vertices[0],
this.hitbox.vertices[1]);-1==this.strafingSide?calculateVector(d,this.hitbox.vertices[0],this.strafingVector):calculateVector(d,this.hitbox.vertices[1],this.strafingVector);unitVector(this.strafingVector,this.strafingVector);this.strafingVector.x=this.strafingVector.x*this.acceleration/3;this.strafingVector.y=this.strafingVector.y*this.acceleration/3;var d=new Vector(this.strafingVector.x+this.inertiaVector.x,this.strafingVector.y+this.inertiaVector.y),a=norm(d);a<=this.maxSpeed?0==a?(this.hitbox.velocity=
a,this.hitbox.versor.x=0,this.hitbox.versor.y=0):(unitVector(d,d),this.hitbox.velocity=a,this.hitbox.versor.x=d.x,this.hitbox.versor.y=d.y):(unitVector(d,d),this.hitbox.versor.x=d.x,this.hitbox.versor.y=d.y);this.auxHitbox.velocity=this.hitbox.velocity;this.auxHitbox.versor=this.hitbox.versor}};this.strafe=function(a,b){this.isStrafing=b;this.strafingSide="l"==a?1:-1};this.throttle=function(a){this.engineOn=a};this.brake=function(a){this.braking=a};this.reverseThrottle=function(a){this.reverseEngineOn=
a};this.calculateAngle=function(a){pathVector=new Vector(0,0);frontVector=new Vector(0,0);calculateVector(a,this.hitbox.center,pathVector);0==this.hitbox.velocity?(calculateVector(this.front,this.hitbox.center,frontVector),unitVector(frontVector,frontVector)):(frontVector.x=this.engineVersor.x,frontVector.y=this.engineVersor.y);translatedPoint=new Point(this.hitbox.center.x-a.x,this.hitbox.center.y-a.y);list=[];list.push(translatedPoint);rotatedVector=new Vector(0,0);a=degreesToRadians(90);rotatedVector.x=
frontVector.x*Math.cos(a)-frontVector.y*Math.sin(a);rotatedVector.y=frontVector.x*Math.sin(a)+frontVector.y*Math.cos(a);myProjection=projection(list,rotatedVector);this.pathAngle=angleVectors(frontVector,pathVector);this.pathAngle=radiansToDegrees(this.pathAngle);0<myProjection.min&&(this.pathAngle*=-1)};this.drawAutoPath=function(){this.lock&&(ctx.setLineDash([4]),ctx.strokeStyle=this.primaryColor,ctx.beginPath(),ctx.moveTo(this.hitbox.center.x,this.hitbox.center.y),ctx.lineTo(this.autoPath.x,this.autoPath.y),
ctx.stroke(),ctx.setLineDash([0]))};this.autoRotate=function(){0!=this.pathAngle&&(0<this.pathAngle?this.pathAngle>=this.turnRate?(this.pathAngle-=this.turnRate,this.turn("r",!0)):(this.turn("r",!0),this.updateTurn(),this.turn("l",!1),this.pathAngle=0):this.pathAngle<this.turnRate?(this.pathAngle+=this.turnRate,this.turn("l",!0)):(this.turn("l",!0),this.updateTurn(),this.turn("l",!1),this.pathAngle=0))};this.autoPilot=function(){this.lock&&(this.autoStatus.phase1?(this.calculateAngle(this.autoPath),
this.autoStatus.phase1=!1,this.autoStatus.current++):this.autoStatus.phase2?(this.throttle(!1),this.brake(!0),0==this.hitbox.velocity&&(this.autoStatus.phase2=!1,this.brake(!1),this.autoStatus.current++)):this.autoStatus.phase3?(this.calculateAngle(this.autoPath),this.autoStatus.phase3=!1):this.autoStatus.phase4?(this.autoRotate(),0==this.pathAngle&&(this.autoStatus.phase4=!1)):this.autoStatus.phase5?distance(this.hitbox.center,this.autoPath)/this.hitbox.velocity>this.hitbox.velocity/this.acceleration?
this.throttle(!0):(this.autoStatus.phase5=!1,this.throttle(!1)):this.autoStatus.phase6&&(this.brake(!0),0==this.hitbox.velocity&&(this.autoStatus.phase6=!1,this.brake(!1),this.lock=!1)))};this.autoStatus=new Phases;this.setupAutoPilot=function(a){this.autoPath=new Point(a.x,a.y);this.autoStatus.phase1=!0;this.autoStatus.phase2=!0;this.autoStatus.phase3=!0;this.autoStatus.phase4=!0;this.autoStatus.phase5=!0;this.autoStatus.phase6=!0;this.autoStatus.current=0};this.drawStatus=function(a){a=void 0===
a?this.secondaryColor:a;canvas=void 0==camera?c:camera;ctx.beginPath();ctx.font="14px Arial";ctx.fillStyle=a;string="Hull: "+this.hull.current;ctx.fillText(string,canvas.width-200,30);string="Immunity: "+this.immunity;ctx.fillText(string,canvas.width-200,60);string="Energy: "+this.powerSupply.current;ctx.fillText(string,canvas.width-200,90);void 0!=this.shield&&(string=this.shield.enabled?"Shield enabled: "+this.shield.current:"Shield disabled: "+this.shield.current,ctx.fillText(string,canvas.width-
200,120))};this.draw=function(a){a=void 0===a?this.hitbox:a;ctx.save();ctx.lineWidth=3;ctx.beginPath();1==a.hit&&0==this.shield.current?(ctx.strokeStyle="#FF0000",ctx.fillStyle="#FF0000"):(ctx.strokeStyle=this.primaryColor,ctx.fillStyle=this.primaryColor);for(var b=0;b<a.vertices.length;b++)ctx.beginPath(),ctx.arc(a.vertices[b].x,a.vertices[b].y,3,0,2*Math.PI),2==b&&(ctx.fillStyle=this.secondaryColor),ctx.fill();for(b=0;b<a.vertices.length-1;b++)ctx.beginPath(),ctx.moveTo(a.center.x,a.center.y),ctx.lineTo(a.vertices[b].x,
a.vertices[b].y),ctx.stroke();for(b=0;b<a.vertices.length-1;b++)ctx.beginPath(),ctx.moveTo(a.vertices[2].x,a.vertices[2].y),ctx.lineTo(a.vertices[b].x,a.vertices[b].y),ctx.stroke();void 0!=a.center&&(ctx.fillStyle=this.secondaryColor,ctx.beginPath(),ctx.arc(a.center.x,a.center.y,3,0,2*Math.PI),ctx.fill());1==this.immunity&&(ctx.strokeStyle=this.secondaryColor,ctx.beginPath(),ctx.arc(a.center.x,a.center.y,a.side+2,0,2*Math.PI),ctx.stroke());this.shield.enabled&&0<this.shield.current&&(ctx.save(),ctx.strokeStyle=
1==a.hit?this.primaryColor:this.secondaryColor,ctx.beginPath(),ctx.arc(a.center.x,a.center.y,a.side+2,0,2*Math.PI),ctx.stroke(),ctx.restore());ctx.restore()};this.setImmunity=function(a){this.immunity=!0;setTimeout(function(){this.player.immunity=!1},1E3*a)};this.addWeapon=function(a){this.weapons.push(a)};this.changeWeapon=function(){this.weapons[this.currentWeapon].firing=!1;this.currentWeapon++;this.currentWeapon%=this.weapons.length;this.weapon=this.weapons[this.currentWeapon]};this.cycleEnabledWeapons=
function(){this.currentWeapon++;this.currentWeapon%=this.weapons.length;this.weapons[this.currentWeapon].enabled=this.weapons[this.currentWeapon].enabled?!1:!0};this.sufferDamage=function(a){1!=this.immunity&&(void 0!=this.shield&&this.shield.enabled&&0<this.shield.current?(a=this.shield.sufferDamage(a))&&this.hull.sufferDamage(a):this.hull.sufferDamage(a),0>this.hull.current&&(this.dead=!0,null!=this.deadSound&&soundPool.ignoreQueue(this.deadSound)))}};
function displayValueConsole(a){console.log("engine: "+a.getEngineValue());console.log("hull:"+a.hull.getValue());console.log("shield:"+a.shield.getValue());console.log("power source:"+a.powerSupply.getValue());console.log("Weapons");for(var b=0;b<a.weapons.length;b++)console.log(a.weapons[b].name+": "+a.weapons[b].getValue());console.log("ship total: "+a.getValue())}
function describeShipConsole(a){console.log(a.name);var b;b="Shield --"+JSON.stringify(a.shield.describe());console.log(b);b="Hull--"+JSON.stringify(a.hull.describe());console.log(b);b="Energy Source--"+JSON.stringify(a.powerSupply.describe());console.log(b);b="Engine--"+JSON.stringify(a.describeEngine());console.log(b)}
function drawStats(a){ctx.save();ctx.beginPath();ctx.fillStyle="#FFFFFF";ctx.fillRect(c.width/3-20,20,c.width/1.5,20*(6+a.weapons.length));ctx.fillStyle="#000000";ctx.font="11px arial";for(var b="Hull--"+JSON.stringify(a.hull.describe()),e=0;10>e;e++)b=b.replace('"',"");ctx.fillText(b,c.width/3,40);b="Engine--"+JSON.stringify(a.describeEngine());for(e=0;10>e;e++)b=b.replace('"',"");ctx.fillText(b,c.width/3,60);b="Energy Source--"+JSON.stringify(a.powerSupply.describe());for(e=0;10>e;e++)b=b.replace('"',
"");ctx.fillText(b,c.width/3,80);ctx.font="10px arial";var b;b="Shield --"+JSON.stringify(a.shield.describe());for(e=0;10>e;e++)b=b.replace('"',"");ctx.fillText(b,c.width/3,100);ctx.fillText("Weapons --",c.width/3,120);for(var f=0;f<a.weapons.length;f++){b=JSON.stringify(a.weapons[f].describe());for(e=0;10>e;e++)b=b.replace('"',"");ctx.fillText(b,c.width/3,140+20*f)}ctx.restore()};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6-impl","es3");
var Weapon=function(a,b,c,d,e,f,g,l,k,m,h){a=void 0===a?10:a;b=void 0===b?1:b;c=void 0===c?1E3:c;d=void 0===d?10:d;e=void 0===e?10:e;f=void 0===f?1:f;l=void 0===l?0:l;k=void 0===k?!1:k;m=void 0===m?100:m;h=void 0===h?0:h;this.mode="m";this.firing=this.enabled=this.turret=!1;this.rateOfFire=void 0===g?8:g;this.lockDown=!1;this.position=new Point(0,0);this.center=new Point(0,0);this.direction=new Vector(0,0);this.projectileVelocity=a;this.projectileWidth=b;this.range=c;this.limit=d;this.mass=f;this.damage=
e;this.hasAmmo=k;this.energyUsage=h;this.sound=null;this.timeOutArray=[];this.timeOutId=0;this.timeOutSound=function(){null!=this.sound&&(this.timeOutArray[this.timeOutId].currentTime=0,this.timeOutArray[this.timeOutId].play(),this.timeOutId++,this.timeOutId%=this.timeOutLimit)};this.timeOutLimit=3;this.loadSounds=function(a){for(var n=0;n<this.timeOutLimit;n++){var b=document.createElement("audio");b.src=a.src;b.volume=a.volume;this.timeOutArray[n]=b}};this.buffer=null;this.playSound=function(){null!=
this.sound&&(this.sound.currentTime=0,this.sound.play())};this.stopSound=function(){null!=this.sound&&this.sound.stop()};this.loopSound=function(){0==this.sound.currentTime&&this.sound.play();var a=this.sound.length,a=a/1E3;this.sound.currentTime>a&&setTimeout(this.playSound(),a)};this.ammo=k?m:1;0<h&&(this.powerSupply=new EnergySource(0,0));this.turnRate=0;this.projectileHeight=2*this.projectileVelocity;this.projectiles=[];this.describe=function(){var a=[];a.push("Name: "+this.name,"Damage: "+this.damage,
"Rate Of Fire: "+this.rateOfFire,"Range: "+this.range,this.hasAmmo?"Ammo: "+this.ammo:"Energy Usage: "+this.energyUsage,this.turret?"Turret: yes":"Turret: no");return a};this.setMode=function(a){this.mode=a};this.setTurnRate=function(a){this.turnRate=a};this.setTurretMode=function(a){this.turret=a};this.setOwner=function(a){this.owner=a};this.setPosition=function(a){this.position=a};this.setCenter=function(a){this.center=a};this.setPowerSupply=function(a){this.powerSupply=a};this.getValue=function(){var a;
"m"==this.type?a=100*this.damage:(a=this.range/100+this.projectileVelocity,a+=this.damage*this.rateOfFire);a=this.hasAmmo?"m"==this.type?a-100/this.ammo:a-10/this.ammo:a-this.energyUsage;a-=this.limit;this.turret&&(a*=4);return Math.round(a)};this.updateDirection=function(){calculateVector(this.position,this.center,this.direction);unitVector(this.direction,this.direction);this.turret&&(this.direction.x*=-1,this.direction.y*=-1)};this.updateFiring=function(a){if(!(this.projectiles.length>=this.limit||
0==this.firing||1==this.lockDown||0>=this.ammo)){if(0<this.energyUsage){if(this.powerSupply.current<this.energyUsage)return;this.powerSupply.drain(h)}null!=this.sound&&soundPool.addSound(this.sound);this.lockDown=!0;a=new Rect(this.position.x,this.position.y-this.projectileHeight/2,this.projectileWidth,this.projectileHeight,this.direction.x,this.direction.y,this.projectileVelocity+a,0);a.hit=!1;a.mass=this.mass;a.duration=this.range/this.velocity;yAxis=new Vector(0,1);var b=angleVectors(this.direction,
yAxis);this.turret?this.position.x<this.center.x&&(b*=-1):this.position.x>this.center.x&&(b*=-1);rotatePolygon(a,radiansToDegrees(b));a.spin=l;a.duration=this.range/this.projectileVelocity;this.projectiles.push(a);this.hasAmmo&&this.ammo--;this.resetLockDown(this)}};this.fire=function(a){this.firing=a};this.updateDuration=function(){for(var a=0;a<this.projectiles.length;a++)this.projectiles[a].duration--,0>=this.projectiles[a].duration&&("m"==this.type&&explosions.push(new Explosion(this.projectiles[a].position.x,
this.projectiles[a].position.y,this.damage,this.expansionRate,this.maxRadius)),this.projectiles.splice(a,1))};this.autoFire=function(){this.firing=1==this.firing?!1:!0};this.resetLockDown=function(a){setTimeout(function(){a.lockDown=!1},1E3/this.rateOfFire)};this.rotateAtBorder=function(a,b){if("x"==a){rotatingVersor=new Vector(-b.versor.x,b.versor.y);var c=angleVectors(b.versor,rotatingVersor),c=radiansToDegrees(c);0<rotatingVersor.y&&(c*=-1);0<rotatingVersor.x&&(c*=-1)}else"y"==a&&(rotatingVersor=
new Vector(b.versor.x,-b.versor.y),c=angleVectors(b.versor,rotatingVersor),c=radiansToDegrees(c),0>rotatingVersor.x&&(c*=-1),0<rotatingVersor.y&&(c*=-1));rotatePolygon(b,c)};this.onHit=function(a){a.sufferDamage(this.damage)};this.removeProjectiles=function(){for(var a=0;a<this.projectiles.length;a++)1==this.projectiles[a].hit&&(this.projectiles.splice(a,1),a--)};this.draw=function(){this.drawCannon();if(void 0!=this.owner)for(var a=0;a<this.projectiles.length;a++)drawPolygon(this.projectiles[a],
strokeColor=this.owner.primaryColor,hitColor=this.owner.secondaryColor,joints=!0,center=!1,fillColor=this.owner.secondaryColor,centerColor=this.owner.secondaryColor,jointColor=this.owner.secondaryColor);else for(a=0;a<this.projectiles.length;a++)drawPolygon(this.projectiles[a])};this.drawCannon=function(a){a=void 0===a?"#000FFF":a;void 0!=this.owner&&(a=this.owner.secondaryColor);ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=a;0==this.turret?(ctx.moveTo(this.center.x,this.center.y),ctx.lineTo(this.center.x+
20*this.direction.x,this.center.y+20*this.direction.y)):(ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(this.position.x+20*this.direction.x,this.position.y+20*this.direction.y));ctx.stroke()}};
function drawHeavyBlaster(a,b,c,d,e,f,g){b=void 0===b?"#0000FF":b;c=void 0===c?"#FF0000":c;d=void 0===d?!0:d;e=void 0===e?!0:e;f=void 0===f?"#00F0FF":f;g=void 0===g?"#0000FF":g;ctx.save();ctx.beginPath();ctx.lineWidth=4;ctx.strokeStyle=1==a.hit?c:b;ctx.moveTo(a.vertices[0].x,a.vertices[0].y);ctx.lineTo(a.vertices[3].x,a.vertices[3].y);ctx.moveTo(a.vertices[1].x,a.vertices[1].y);ctx.lineTo(a.vertices[2].x,a.vertices[2].y);ctx.stroke();ctx.fillStyle=g;if(d)for(b=0;b<a.vertices.length;b++)ctx.beginPath(),
ctx.arc(a.vertices[b].x,a.vertices[b].y,3,0,2*Math.PI),ctx.fill();e&&void 0!=a.center&&(ctx.fillStyle=f,ctx.beginPath(),ctx.arc(a.center.x,a.center.y,3,0,2*Math.PI),ctx.fill());ctx.restore()}function machineGun(){cannon=new Weapon(velocity=4,width=1,range=200,limit=12,damage=6,mass=100,rateOfFire=16,spin=0,hasAmmo=!0,ammo=2E3);cannon.type="p";cannon.name="Machine Gun";cannon.sound=new Howl({src:["machine_gun.mp3"]});cannon.sound.volumeFilter=.2;return cannon}
function lightCannon(){cannon=new Weapon(velocity=2,width=4,range=250,limit=10,damage=10,mass=100,rateOfFire=8,spin=120,hasAmmo=!0,ammo=1E3);cannon.projectileVelocity=10;cannon.type="p";cannon.name="Light Cannon";cannon.sound=new Howl({src:["heavycannon.mp3"]});return cannon}
function heavyCannon(){cannon=new Weapon(velocity=4,width=8,range=280,limit=10,damage=20,mass=1E3,rateOfFire=4,spin=120,hasAmmo=!0,ammo=500);cannon.projectileVelocity=10;cannon.type="p";cannon.name="Heavy Cannon";cannon.sound=new Howl({src:["heavycannon.mp3"]});return cannon}
function asteroidShooter(){cannon=new Weapon(velocity=10,width=20,range=280,limit=1,damage=50,mass=1E4,rateOfFire=1,spin=120,hasAmmo=!0,ammo=50);cannon.projectileVelocity=10;cannon.type="p";cannon.name="Asteroid Shooter";cannon.sound=new Howl({src:["heavycannon.mp3"]});return cannon}
function dumbMissile(){missile=new Weapon(velocity=10,width=1,range=1E3,limit=1,damage=1,mass=100,rateOfFire=1,spin=0,hasAmmo=!0,ammo=100);missile.expansionRate=2;missile.maxRadius=20;missile.projectileVelocity=5;missile.type="m";missile.name="Dumb Missile";missile.onHit=function(a){void 0==a.hitbox&&(a.hitbox=a);center=1==a.hitbox.sides?a.hitbox.position:a.hitbox.center;explosions.push(new Explosion(center.x,center.y,this.damage,this.expansionRate,this.maxRadius))};missile.onBorder=function(a){explosions.push(new Explosion(a.x,
a.y,this.damage,this.expansionRate,this.maxRadius))};return missile}
function lightLaserBlaster(){blaster=new Weapon(velocity=30,width=1,range=400,limit=12,damage=5,mass=1,rateOfFire=12,spin=0,hasAmmo=!1,ammo=1,energyUsage=5);blaster.type="p";blaster.draw=function(){void 0!=this.owner&&(color=this.owner.secondaryColor,ctx.beginPath(),ctx.lineWidth=2,ctx.strokeStyle=color,0==this.turret?(ctx.moveTo(this.center.x,this.center.y),ctx.lineTo(this.center.x+20*this.direction.x,this.center.y+20*this.direction.y)):(ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(this.position.x+
20*this.direction.x,this.position.y+20*this.direction.y)),ctx.stroke());if(void 0==blaster.owner)for(var a=0;a<this.projectiles.length;a++)drawPolygon(this.projectiles[a],strokeColor="#0000FF",hitColor="#0FF0FF",joints=!1,center=!1,fillColor="#0F00FF");else for(a=0;a<this.projectiles.length;a++)drawPolygon(this.projectiles[a],strokeColor=this.owner.primaryColor,hitColor=this.owner.secondaryColor,joints=!1,center=!1,fillColor="#0F00FF")};blaster.name="Light Laser Blaster";blaster.sound=new Howl({src:["Laser_Shoot.mp3"]});
blaster.sound.volume(.5);return blaster}
function heavyLaserBlaster(){blaster=new Weapon(velocity=30,width=8,range=400,limit=8,damage=20,mass=1,rateOfFire=6,spin=0,hasAmmo=!1,ammo=1,energyUsage=20);blaster.type="p";blaster.draw=function(){void 0!=this.owner&&(color=this.owner.secondaryColor,ctx.beginPath(),ctx.lineWidth=this.projectileWidth,ctx.strokeStyle=color,0==this.turret?(ctx.moveTo(this.center.x,this.center.y),ctx.lineTo(this.center.x+10*this.direction.x,this.center.y+10*this.direction.y)):(ctx.moveTo(this.position.x,this.position.y),
ctx.lineTo(this.position.x+10*this.direction.x,this.position.y+10*this.direction.y)),ctx.stroke());if(void 0==blaster.owner)for(var a=0;a<this.projectiles.length;a++)drawHeavyBlaster(this.projectiles[a],strokeColor="#0000FF",hitColor="#0FF0FF",joints=!1,center=!1,fillColor="#0F00FF");else for(a=0;a<this.projectiles.length;a++)drawHeavyBlaster(this.projectiles[a],strokeColor=this.owner.primaryColor,hitColor=this.owner.secondaryColor,joints=!1,center=!1,fillColor="#0F00FF")};blaster.name="Heavy Laser Blaster";
blaster.sound=new Howl({src:["Laser_Shoot2.mp3"]});blaster.sound.volume(.5);return blaster}
function lightLaserBeam(){beam=new Weapon(velocity=100,width=2,range=800,limit=1,damage=1,mass=1,rateOfFire=1E3,spin=0,hasAmmo=!1,ammo=1,energyUsage=4);beam.type="l";beam.draw=function(){ctx.beginPath();ctx.strokeStyle=void 0==this.owner?"#009099":this.owner.secondaryColor;oldWidth=ctx.lineWidth;ctx.lineWidth=this.projectileWidth;for(var a=0;a<this.projectiles.length;a++)ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(this.projectiles[a].vertices[3].x,this.projectiles[a].vertices[3].y);ctx.stroke();
ctx.lineWidth=oldWidth};beam.name="Light Laser Beam";beam.sound=new Howl({src:["laser-reapeated.mp3"]});beam.sound.volume(.5);return beam}
function heavyLaserBeam(){beam=new Weapon(velocity=100,width=8,range=800,limit=1,damage=5,mass=1,rateOfFire=60,spin=0,hasAmmo=!1,ammo=1,energyUsage=9);beam.type="l";beam.draw=function(){ctx.strokeStyle=void 0==blaster.owner?"#009099":this.owner.secondaryColor;ctx.beginPath();oldWidth=ctx.lineWidth;ctx.lineWidth=beam.projectileWidth;for(var a=0;a<this.projectiles.length;a++)ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(this.projectiles[a].vertices[3].x,this.projectiles[a].vertices[3].y);ctx.stroke();
ctx.lineWidth=oldWidth};beam.name="Heavy Laser Beam";beam.sound=new Howl({src:["laser-reapeated.mp3"]});beam.sound.volume(.5);return beam}function killProjectile(a){a.duration=0}function buildWeaponsStatus(a){for(var b=[],c=0;c<a.length;c++)string=a[c].enabled?a[c].name+": enabled":a[c].name+": disabled",a[c].hasAmmo&&(string+=" --- Ammo: "+a[c].ammo),b.push(string),a[c].turret&&("a"==a[c].mode&&(string="Turret : automatic"),"m"==a[c].mode&&(string="Turret : manual"),b.push(string));return b}
function drawWeaponsStatus(a,b){b=void 0===b?"#00F0FF":b;ctx.beginPath();ctx.fillStyle=b;ctx.font="14px Arial";for(var c=0,d=0;d<a.length;d++)0==d%6&&(c+=240),ctx.fillText(a[d],c-230,40+d%6*20)}function drawShipWeapons(a){for(var b=0;b<a.weapons.length;b++)a.weapons[b].draw()}
function checkProjectilesBorder(a){for(u=0;u<a.weapons.length;u++)for(var b=0;b<a.weapons[u].projectiles.length;b++)if(a.weapons[u].projectiles[b].update(),"p"==a.weapons[u].type)checkBorder(a.weapons[u].projectiles[b],function(){a.weapons[u].rotateAtBorder(axis,a.weapons[u].projectiles[b])});else if("l"==a.weapons[u].type){projectile=a.weapons[u].projectiles[b];var c=checkBorder(projectile);c&&killProjectile(projectile)}else"m"==a.weapons[u].type&&(projectile=a.weapons[u].projectiles[b],c=checkBorder(projectile))&&
(a.weapons[u].onBorder(projectile.center),killProjectile(projectile))};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,d,e){if(b){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in d||(d[f]={});d=d[f]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,d,e){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==e||e>b)e=b;e=Number(e);0>e&&(e=Math.max(0,b+e));for(d=Number(d||0);d<e;d++)this[d]=a;return this}},"es6-impl","es3");
function loadDefaultSounds(a){a.hull.sound=new Howl({src:["Hit_Hurt5.mp3"]});a.shield.sound=a.hull.sound;a.deadSound=new Howl({src:["Explosion4.mp3"]});return a}
var Stellar=function(a,b,d,e){d=void 0===d?c.width/2:d;e=void 0===e?c.height/2:e;a=new Ship(d,e,20,void 0===a?"#000FFF":a,void 0===b?"#0FF0FF":b);a.name="Stellar";a.updateDirection();a.hull=new Hull(100,0);a.shield=new Shield(50,0,5,1,300);a.acceleration=.21;a.turnRate=5;a.shield.setPowerSupply(a.powerSupply);a.shield.setEnabled(!0);a.addWeapon(machineGun());a.changeWeapon();a.weapon.setOwner(a);a.weapon.setCenter(a.hitbox.vertices[0]);a.weapon.setPosition(a.auxHitbox.vertices[0]);a.weapon.enabled=
!0;a.addWeapon(machineGun());a.changeWeapon();a.weapon.setOwner(a);a.weapon.setCenter(a.hitbox.vertices[1]);a.weapon.setPosition(a.auxHitbox.vertices[1]);a.weapon.enabled=!0;a.weapon.setPowerSupply(a.powerSupply);a.addWeapon(machineGun());a.changeWeapon();a.weapon.setOwner(a);a.weapon.setPosition(a.hitbox.center);a.weapon.setCenter(coord);a.weapon.setTurretMode(!0);a.weapon.enabled=!0;return a=loadDefaultSounds(a)},Gargatuan=function(a,b,d,e){d=void 0===d?c.width/2:d;e=void 0===e?c.height/2:e;a=new Ship(d,
e,30,void 0===a?"#0000FF":a,void 0===b?"#0FF0FF":b);a.name="Gargantuan";a.updateDirection();a.hull=new Hull(200,1);a.shield=new Shield(300,0,20,.5,300);a.powerSupply=new EnergySource(1E3,20,100);a.shield.setPowerSupply(a.powerSupply);a.shield.setEnabled(!0);a.acceleration=.08;a.maxSpeed=7;a.turnRate=4;a.addWeapon(heavyLaserBlaster());a.changeWeapon();a.weapon.setOwner(a);a.weapon.setPowerSupply(a.powerSupply);a.weapon.setCenter(a.hitbox.vertices[0]);a.weapon.setPosition(a.auxHitbox.vertices[0]);a.weapon.enabled=
!0;a.addWeapon(heavyLaserBlaster());a.changeWeapon();a.weapon.setOwner(a);a.weapon.setCenter(a.hitbox.vertices[1]);a.weapon.setPosition(a.auxHitbox.vertices[1]);a.weapon.setPowerSupply(a.powerSupply);a.weapon.enabled=!0;a.addWeapon(heavyLaserBeam());a.changeWeapon();a.weapon.setOwner(a);a.weapon.setPowerSupply(a.powerSupply);a.weapon.setPosition(a.front);a.weapon.setCenter(a.hitbox.center);a.weapon.enabled=!0;return a=loadDefaultSounds(a)},Colossal=function(a,b,d,e){d=void 0===d?c.width/2:d;e=void 0===
e?c.height/2:e;a=new Ship(d,e,50,void 0===a?"#0000FF":a,void 0===b?"#0FF0FF":b);a.name="Colossal";a.updateDirection();a.hull=new Hull(1E3,1);a.shield=new Shield(2E3,0,50,1,150);a.powerSupply=new EnergySource(2E3,20,100);a.shield.setPowerSupply(a.powerSupply);a.shield.setEnabled(!0);a.acceleration=.04;a.maxSpeed=9;for(b=a.turnRate=2;b<a.hitbox.vertices.length;b++)a.addWeapon(heavyLaserBlaster()),a.changeWeapon(),a.weapon.setOwner(a),a.weapon.setPowerSupply(a.powerSupply),a.weapon.setCenter(a.hitbox.vertices[b]),
a.weapon.setPosition(a.auxHitbox.vertices[b]),a.weapon.enabled=!0;for(b=0;b<a.hitbox.vertices.length-1;b++)a.addWeapon(lightLaserBlaster()),a.changeWeapon(),a.weapon.setOwner(a),a.weapon.setPowerSupply(a.powerSupply),a.weapon.setCenter(coord),a.weapon.setPosition(a.hitbox.vertices[b%3]),a.weapon.setTurretMode(!0),a.weapon.enabled=!0;return a=loadDefaultSounds(a)},Turret=function(a,b,d,e,f,h,g){d=void 0===d?1:d;e=void 0===e?c.width/2:e;f=void 0===f?c.height/2:f;g=void 0===g?machineGun:g;a=new Ship(e,
f,void 0===h?15:h,void 0===a?"#0000FF":a,void 0===b?"#0FF0FF":b);a.name="Turret";a.updateDirection();a.hull=new Hull(50,3);a.shield=new Shield(20,0,5,.5,300);a.powerSupply=new EnergySource(500,10,100);a.shield.setPowerSupply(a.powerSupply);a.shield.setEnabled(!0);a.acceleration=.08;a.maxSpeed=3;a.turnRate=3;if(1==d)a.addWeapon(g()),a.changeWeapon(),a.weapon.setOwner(a),a.weapon.setPowerSupply(a.powerSupply),a.weapon.setCenter(coord),a.weapon.setPosition(a.hitbox.center),a.weapon.setTurretMode(!0),
a.weapon.enabled=!0;else for(b=0;b<d;b++)a.addWeapon(g()),a.changeWeapon(),a.weapon.setOwner(a),a.weapon.setPowerSupply(a.powerSupply),a.weapon.setCenter(coord),a.weapon.setPosition(a.hitbox.vertices[b%3]),a.weapon.setTurretMode(!0),a.weapon.enabled=!0;a.draw=function(a){a=void 0===a?this.hitbox:a;ctx.save();ctx.lineWidth=3;ctx.beginPath();1==a.hit&&0==this.shield.current?(ctx.strokeStyle="#FF0000",ctx.fillStyle="#FF0000"):(ctx.strokeStyle=this.primaryColor,ctx.fillStyle=this.primaryColor);for(var b=
0;b<a.vertices.length;b++)ctx.beginPath(),ctx.moveTo(a.center.x,a.center.y),ctx.lineTo(a.vertices[b].x,a.vertices[b].y),ctx.stroke();for(b=0;b<a.vertices.length;b++)ctx.beginPath(),ctx.arc(a.vertices[b].x,a.vertices[b].y,3,0,2*Math.PI),2==b&&(ctx.fillStyle=this.secondaryColor),ctx.fill();void 0!=a.center&&(ctx.fillStyle=this.secondaryColor,ctx.beginPath(),ctx.arc(a.center.x,a.center.y,3,0,2*Math.PI),ctx.fill());1==this.immunity&&(ctx.strokeStyle=this.secondaryColor,ctx.beginPath(),ctx.arc(a.center.x,
a.center.y,a.side+2,0,2*Math.PI),ctx.stroke());this.shield.enabled&&0<this.shield.current&&(ctx.save(),ctx.strokeStyle=1==a.hit?this.primaryColor:this.secondaryColor,ctx.beginPath(),ctx.arc(a.center.x,a.center.y,a.side+2,0,2*Math.PI),ctx.stroke(),ctx.restore());ctx.restore()};return a=loadDefaultSounds(a)};
function fetchShipByName(a){if("Stellar"==a)var b=new Stellar;else"Gargantuan"==a?b=new Gargatuan:"Colossal"==a?b=new Colossal:"Turret"==a&&(b=new Turret("#000FFF","#00F0FF",3,c.width/2,c.height/2,20,dumbMissile));return b};
function collideHitboxes(a){for(var b=0;b<a.length-1;b++)for(var c=b+1;c<a.length;c++)hit=elasticCollision(a[b],a[c],void 0,void 0,.1)}function collideShipHitboxes(a,b,c){if(0!=b.length)for(var d=0;d<b.length;d++){var e=[];e.push(a.auxHitbox);if(hit=elasticCollision(a.hitbox,b[d],e,void 0,.1))a.sufferDamage(c),b[d].sufferDamage(c)}}
function collideShipShips(a,b,c){var d=[];d.push(a.auxHitbox);for(var e=0;e<b.length;e++)if(bindB=[],bindB.push(b[e].auxHitbox),hit=elasticCollision(a.hitbox,b[e].hitbox,d,bindB,.1))a.sufferDamage(c),b[e].sufferDamage(c)}function collideWeaponsHitboxes(a,b){for(var c=0;c<a.weapons.length;c++)for(var d=0;d<a.weapons[c].projectiles.length;d++)for(var e=0;e<b.length;e++)smartCollision(a.weapons[c].projectiles[d],b[e],function(){a.weapons[c].onHit(b[e])})}
function collideWeaponsShips(a,b){for(var c=0;c<a.weapons.length;c++)for(var d=0;d<a.weapons[c].projectiles.length;d++)for(var e=0;e<b.length;e++)shipBind=[],shipBind.push(b[e].auxHitbox),smartCollision(a.weapons[c].projectiles[d],b[e].hitbox,function(){a.weapons[c].onHit(b[e])})}function collideShipsExplosions(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<a.length;d++)smartCollision(b[c].hitbox,a[d].hitbox,function(){a[d].sufferDamage(b[c].fetchDamage(a[d].hitbox))})}
function collideHitboxesExplosions(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<a.length;d++)smartCollision(b[c].hitbox,a[d],function(){a[d].sufferDamage(b[c].fetchDamage(a[d]))})};
function updateTargetSystem(a,b){a.targetSystem.updateRefresh();0<a.targetSystem.refreshIndex||(a.targetSystem.setPossibleTargets(b),a.targetSystem.clearAimAssist(),a.targetSystem.analyseTarget(a.hitbox.center),a.targetSystem.aimAssist(a.weapons,a.hitbox.velocity),a.targetSystem.autoAim(a.weapons),a.targetSystem.autoFire(a.weapons))}
function updateShip(a){a.updateDirection();a.updateStrafe();a.updatePosition();a.updateTurn();a.powerSupply.recharge(a.powerSupply);a.shield.drainEnergy(a.shield);calculateAxes(a.hitbox)}function updateHitbox(a){a.update();checkBorder(a);calculateAxes(a);rotatePolygon(a,a.spin)}
function updateEnemy(a){updateShip(a);updateWeapons(a);checkBorder(a.hitbox,function(){a.auxHitbox.applyVector(diff);a.engineOn?(a.engineOn=!1,a.reverseEngineOn=!0):(a.engineOn=!0,a.reverseEngineOn=!1)});collideShipHitboxes(a,objects);updateShipProjectiles(a);checkProjectilesBorder(a)}function updateWeaponsAxes(a){for(var b=0;b<a.weapons.length;b++)for(var c=0;c<a.weapons[b].projectiles.length;c++)calculateAxes(a.weapons[b].projectiles[c])}
function updateShipProjectiles(a){for(var b=0;b<a.weapons.length;b++)a.weapons[b].updateDuration(),a.weapons[b].removeProjectiles()}function updateWeaponsShooting(a){for(var b=0;b<a.weapons.length;b++)a.weapons[b].updateDirection(),a.weapons[b].enabled&&a.weapons[b].updateFiring(a.hitbox.velocity)}function updateWeapons(a){updateWeaponsShooting(a);updateWeaponsAxes(a)}
function displayShip(a){a.updateDirection();a.updateStrafe();a.updatePosition();a.updateTurn();a.powerSupply.recharge(a.powerSupply);a.shield.drainEnergy(a.shield);for(var b=0;b<a.weapons.length;b++)a.weapons[b].firing=!0,a.weapons[b].updateDirection(),a.weapons[b].enabled&&a.weapons[b].updateFiring(a.hitbox.velocity);for(b=0;b<a.weapons.length;b++)a.weapons[b].updateDuration(),a.weapons[b].removeProjectiles();for(c=0;c<a.weapons.length;c++)for(b=0;b<a.weapons[c].projectiles.length;b++)a.weapons[c].projectiles[b].update(),
projectile=a.weapons[c].projectiles[b],checkBorder(projectile)&&killProjectile(projectile),rotatePolygon(a.weapons[c].projectiles[b],a.weapons[c].projectiles[b].spin);for(var c=0;c<a.weapons.length;c++)for(b=0;b<a.weapons[c].projectiles.length;b++)calculateAxes(a.weapons[c].projectiles[b]),a.weapons[c].draw();a.draw()};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,b,c){if(e){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var d=a[c];d in b||(b[d]={});b=b[d]}a=a[a.length-1];c=b[a];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,b,c){var d=this.length||0;0>b&&(b=Math.max(0,d+b));if(null==c||c>d)c=d;c=Number(c);0>c&&(c=Math.max(0,d+c));for(b=Number(b||0);b<c;b++)this[b]=a;return this}},"es6-impl","es3");
var Button=function(a,e,b,c,d){this.x=a;this.y=e;this.width=b;this.height=c;this.string=void 0===d?" ":d;this.bgColor="#FFFFFF";this.fontColor="#000000";this.onClick=function(){};this.onHover=function(){this.bgColor="#666666"};this.draw=function(){ctx.fillStyle=this.bgColor;ctx.fillRect(this.x,this.y,this.width,this.height);ctx.fillStyle=this.fontColor;ctx.font="14px arial";ctx.fillText(this.string,this.x+this.width/10,this.y+this.height/2)};this.reset=function(){this.bgColor="#FFFFFF"}},CircularButton=
function(a,e,b,c,d){this.x=a;this.y=e;this.radius=b;this.color=c;this.string=d;this.onClick=function(){};this.draw=function(){ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,2*Math.PI);ctx.fill();ctx.fillStyle="#000000";ctx.font="14px arial";ctx.fillText(d,this.x-this.radius/6,this.y+this.radius/10)}};
function getCookie(b){b+="=";for(var d=decodeURIComponent(document.cookie).split(";"),c=0;c<d.length;c++){for(var a=d[c];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(b))return a.substring(b.length,a.length)}return""}function setCookie(b,d,c){var a=new Date;a.setTime(a.getTime()+864E5*c);c="expires="+a.toUTCString();document.cookie=b+"="+d+";"+c+";path=/"}var deleteCookie=function(b){document.cookie=b+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"};
c.style.cursor="none";
var Cursor=function(b,a){this.color=b;this.angle=0;this.dash=4;this.spin=2;this.radius=void 0===a?5:a;this.point=new Point(0,0);this.setPoint=function(a){this.point=a};this.draw=function(){this.angle+=this.spin;this.angle%=360;ctx.save();ctx.beginPath();ctx.lineWidth=2;ctx.translate(this.point.x,this.point.y);ctx.rotate(degreesToRadians(this.angle));ctx.setLineDash([this.dash]);ctx.strokeStyle=this.color;ctx.arc(0,0,this.radius,0,2*Math.PI);ctx.stroke();ctx.setLineDash([0]);ctx.restore()}};
updateResEvent=function(a){window.addEventListener("resize",function(b){a.width=window.innerWidth-20;a.height=window.innerHeight-20})};
var Score=function(a){void 0==a&&(a="#000FFF");this.coins=this.max=this.player=0;this.getMax=function(){this.max=getCookie("maxScore");0==this.max.length&&(setCookie("maxScore",0,365),this.max=getCookie("maxScore"));this.max=Number(this.max)};this.getCoins=function(){this.coins=getCookie("coins");0==this.coins.length&&(setCookie("coins",0,365),this.coins=getCookie("coins"));this.coins=Number(this.coins)};this.draw=function(a){ctx.beginPath();ctx.fillStyle=a;ctx.font="14px Arial";string="Score: "+
this.player;ctx.fillText(string,c.width/2-40,c.height-20);string="Max Score: "+this.max;ctx.fillText(string,c.width/2-160,c.height-20)}};
function generateAsteroids(a,b,d,f,h,e){for(i=0;i<h;i++)rect=new randomRect(a,b,d,f),rect.hp=Math.round(Math.sqrt(rect.mass)),rect.dead=!1,rect.sufferDamage=asteroidSufferDamage,rect.value=Math.round(rect.hp/40),objects.push(rect);for(i=0;i<e;i++)triangle=new randomTriangle(a,b,d,f),triangle.hp=Math.round(Math.sqrt(triangle.mass)),triangle.dead=!1,triangle.sufferDamage=asteroidSufferDamage,triangle.value=Math.round(triangle.hp/40),objects.push(triangle)}
function generateTurrets(a,b,d,f){d=void 0===d?!1:d;f=void 0===f?1:f;for(var h=0;h<a;h++){var e=Math.random()*c.width,g=Math.random()*c.height;myRandom=Math.random();.95<myRandom?turret=Turret("#FFFFFF","#FF0000",b,e,g,20,dumbMissile):.9<myRandom?(turret=new Turret("#FFFFFF","#FF0000",b,e,g,20,heavyLaserBlaster),turret.hitbox.spin=20):.8<myRandom?turret=Turret("#FFFFFF","#FF0000",b,e,g,20,asteroidShooter):.7<myRandom?turret=Turret("#FFFFFF","#FF0000",b,e,g,20,heavyCannon):.6<myRandom?(turret=new Turret("#FFFFFF",
"#FF0000",b,e,g,20,lightLaserBlaster),turret.hitbox.spin=20):turret=.5<myRandom?Turret("#FFFFFF","#FF0000",b,e,g,20,lightCannon):Turret("#FFFFFF","#FF0000",b,e,g,20,machineGun);for(e=0;e<b;e++)turret.weapons[e].rateOfFire*=f,turret.weapons[e].setCenter(player.hitbox.center),turret.weapons[e].setPosition(turret.hitbox.vertices[e]),turret.weapons[e].mode="a";turret.weapon.setOwner(turret);d&&(turret.engineOn=!0,rotatePolygon(turret.hitbox,360*Math.random()));turret.value=Math.round(10*myRandom);turret.value*=
b;turret.targetSystem.setAutoAim(!0,turret.weapons);turret.targetSystem.refreshRate=4;enemies.push(turret)}}
var Level=function(a){this.current=0;this.max=20;this.draw=function(a){ctx.beginPath();ctx.fillStyle=a;ctx.font="14px Arial";string="Level: "+this.current;ctx.fillText(string,c.width/2+40,c.height-20)};this.start=function(){player.setImmunity(3);12>=this.current?(player.hull.recover(10),0!=this.current%2?generateAsteroids(c.width/20+2*this.current,c.width/100+2*this.current,Math.round(.7*this.current),Math.floor(.2*this.current),Math.round(.6*this.current),Math.round(.4*this.current)):generateTurrets(Math.floor(this.current/
2),1,!0,.25)):13<=this.current&&15>=this.current?generateTurrets(Math.floor(this.current/3),2,!0,.5):generateTurrets(Math.floor(this.current/4),3,!0,.75)};this.next=function(){this.current++}};
function buildInstructions(){var a=[];a.push("W/UpArrow: Main Engine Throttle");a.push("X: Reverse Engine Throttle");a.push("A/LeftArrow: Left Turning");a.push("D/RightArrow: Right Turning");a.push("Q: Left Strafe");a.push("E: Right Strafe");a.push("S/DownArrow: Brake");a.push("Space bar: Fire Main Weapons");a.push("Left-Click: Fire Turrets");a.push("V/Right-Click: Fire Missiles");a.push("C: Always Fire");a.push("H: Turrets Mode");a.push("R: Cycle Weapons");a.push("F: Enable Shield");a.push("T: Change Target");
a.push("U: Auto-pilot");a.push("Esc: Cancel Auto-pilot");a.push(",: Decrease Volume");a.push(".: Increase Volume");return a}function drawInstructions(a,b){b=void 0===b?"#000FFF":b;ctx.save();ctx.beginPath();ctx.fillStyle="#000000";ctx.fillRect(0,0,c.width,c.height/4);ctx.fillStyle=b;ctx.font="14px Arial";for(var d=0,f=0;f<a.length;f++)0==f%7&&(d+=240),ctx.fillText(a[f],d-230,40+f%7*20);ctx.restore()}
function drawEndGame(a,b,d){b=void 0===b?"#000FFF":b;d=void 0===d?"#FF0000":d;a?(ctx.beginPath(),ctx.fillStyle=b,ctx.font="28px Arial",ctx.fillText("Congratulations! You've survived!",c.width/6,c.height/2)):(ctx.beginPath(),ctx.fillStyle=d,ctx.font="28px Arial",ctx.fillText("You've died! Press ESC to restart.",c.width/3,c.height/2))}function killObjects(a){for(i=0;i<a.length;i++)1==a[i].dead&&(score.player+=a[i].value,a.splice(i,1))}
function killShips(a){for(i=0;i<a.length;i++)1==a[i].dead&&(score.player+=a[i].value,explosions.push(new Explosion(a[i].hitbox.center.x,a[i].hitbox.center.y)),a.splice(i,1))}
function drawAsteroid(a,b,d){b=void 0===b?"#FFFFFF":b;d=void 0===d?"#FF0000":d;ctx.save();ctx.beginPath();ctx.lineWidth=3;ctx.strokeStyle=1==a.hit?d:b;ctx.moveTo(a.vertices[0].x,a.vertices[0].y);for(b=0;b<a.vertices.length;b++)ctx.lineTo(a.vertices[b].x,a.vertices[b].y);ctx.lineTo(a.vertices[0].x,a.vertices[0].y);ctx.stroke();ctx.restore()}function asteroidSufferDamage(a){this.hp-=a;0>this.hp&&(this.dead=!0)}
function drawLobbyBackground(){ctx.fillStyle="#000000";ctx.fillRect(0,0,c.width,c.height);ctx.fillStyle="#FFFFFF";ctx.font="28px arial";ctx.fillText("Select your ship",20,40)}
function buildLobbyButtons(a){myButton=new Button(20,200,150,50,"Stellar");myButton.onClick=function(){player=new Stellar(primaryColor,secondaryColor,c.width/2,c.height/2+150);selected=!0};a.push(myButton);myButton=new Button(20,260,150,50,"Gargantuan");myButton.onClick=function(){player=new Gargatuan(primaryColor,secondaryColor,c.width/2,c.height/2+150);selected=!0};a.push(myButton);myButton=new Button(20,320,150,50,"Turret");myButton.onClick=function(){player=new Turret("#000FFF","#00F0FF",3,c.width/
2,c.height/2+150,20,dumbMissile);selected=!0};a.push(myButton);myButton=new Button(20,380,150,50,"Colossal");myButton.onClick=function(){player=new Colossal(primaryColor,secondaryColor,c.width/2,c.height/2+150);selected=!0};a.push(myButton);myButton=new Button(20,100,200,50,"Coins: "+score.coins);myButton.onHover=function(){};a.push(myButton);new Point(c.width/2,c.height/2);var b=[];b.push(new Stellar);b.push(new Gargatuan);b.push(new Turret("#000FFF","#00F0FF",3,c.width/2,c.height/2,20,dumbMissile));
b.push(new Colossal);for(var d=1;d<b.length;d++)a[d].string+=": "+b[d].getValue();b=[];confirmButton=new Button(c.width/2-100,c.height-100,200,50,"Confirm");confirmButton.onClick=function(){"Stellar"==player.name&&(confirmed=!0);score.coins>player.getValue()&&(confirmed=!0)}}
function selectShipLoop(){drawLobbyBackground();window.selected&&(window.displaying||(window.buttons.push(confirmButton),window.displaying=!0),displayShip(player),drawStats(player));for(var a=0;a<buttons.length;a++)window.buttons[a].draw();cursor.setPoint(coord);cursor.draw();confirmed?(c.removeEventListener("touchstart",buttonModeClick,!1),c.removeEventListener("click",function(a){buttonModeClick(a)},!1),c.addEventListener("click",function(a){mouseClick(a)},!1),c.addEventListener("touchstart",pegaCoordenadasMobile,
!1),window.buttons=[],c.width=780,c.height=580,player=fetchShipByName(player.name),window.playing=!0,window.rewarded=!1,selectMusic.pause(),music.play(),explosions=[],requestAnimationFrame(mainLoop)):requestAnimationFrame(selectShipLoop)}
function mainLoop(){newDate=new Date;elapsedTime=newDate-lastDate;lastDate=new Date;fps.add(elapsedTime);ctx.fillStyle="#000000";ctx.fillRect(0,0,c.width,c.height);0==objects.length&&0==enemies.length&&level.current<=level.max&&(level.next(),level.current<=level.max&&level.start());for(var a=0;a<objects.length;a++)updateHitbox(objects[a]);if(player.dead)drawEndGame(!1),score.max<score.player&&setCookie("maxScore",score.player,365),window.rewarded||(score.coins+=30*score.player,setCookie("coins",score.coins,
365),window.rewarded=!0);else{updateShip(player);updateWeapons(player);var b=[];b.push(player);for(a=0;a<enemies.length;a++)updateEnemy(enemies[a]),collideWeaponsShips(enemies[a],b);collideWeaponsHitboxes(player,objects);collideWeaponsShips(player,enemies);checkBorder(player.hitbox,function(){player.auxHitbox.applyVector(diff)})}level.current>level.max&&(drawEndGame(!0),score.max<score.player&&setCookie("maxScore",score.player,365),window.rewarded||(score.coins+=30*score.player,setCookie("coins",
score.coins,365),window.rewarded=!0));collideShipHitboxes(player,objects,COLLISION_DAMAGE);collideShipShips(player,enemies,COLLISION_DAMAGE);updateShipProjectiles(player);checkProjectilesBorder(player);updateTargetSystem(player,enemies);if(!player.dead)for(collideShipsExplosions(b,explosions),a=0;a<enemies.length;a++)updateTargetSystem(enemies[a],b);player.autoPilot();player.drawStatus();player.targetSystem.displayInfo();player.targetSystem.drawAid(player.weapons);instruct?drawInstructions(instructions,
player.secondaryColor):(weaponStatus=buildWeaponsStatus(player.weapons),drawWeaponsStatus(weaponStatus,player.secondaryColor));for(a=0;a<objects.length;a++)drawAsteroid(objects[a]);for(a=0;a<enemies.length;a++)enemies[a].draw(),drawShipWeapons(enemies[a]);0==player.dead&&(drawShipWeapons(player),player.drawAutoPath(),player.draw());killObjects(objects);killShips(enemies);collideHitboxes(objects);collideShipsExplosions(enemies,explosions);collideHitboxesExplosions(objects,explosions);score.draw(player.secondaryColor);
level.draw(player.secondaryColor);updateExplosions(explosions);finishExplosions(explosions);for(a=0;a<explosions.length;a++)explosions[a].draw();fps.calculateMean();drawFPS(fps.mean,player.secondaryColor);soundPool.playQueue();window.soundDisplay&&soundPool.display(player.secondaryColor,new Point(c.width/2-20,100));cursor.setPoint(coord);cursor.draw();window.playing?setTimeout(function(){requestAnimationFrame(mainLoop)},interval):(window.buttons=[],buildLobbyButtons(window.buttons),window.instruct=
!1,window.selected=!1,window.displaying=!1,window.confirmed=!1,window.playing=!1,level.current=0,score.player=0,objects=[],enemies=[],explosions=[],music.pause(),selectMusic.play(),requestAnimationFrame(selectShipLoop))}ctx.lineWidth=3;var j=0,primaryColor="#000FFF",secondaryColor="#00F0FF",lastDate=new Date,fps=new Fps,maxFPS=1E3,interval=1E3/maxFPS,COLLISION_DAMAGE=10,camera=void 0,score=new Score;score.getMax();score.getCoins();
var level=new Level,instructions=buildInstructions(),objects=[],enemies=[],explosions=[],maxSounds=1,startingVolume=5;soundPool=new SoundPool(maxSounds,startingVolume);selectMusic=document.getElementById("selectLoop");selectMusic.play();selectMusic.addEventListener("ended",function(){this.currentTime=0;this.play()},!1);selectMusic.volume=.5;music=document.getElementById("loopA");music.addEventListener("ended",function(){this.currentTime=0;this.play()},!1);music.volume=.5;console.log(selectMusic);
window.buttons=[];buildLobbyButtons(window.buttons);window.instruct=!1;window.selected=!1;window.displaying=!1;window.confirmed=!1;window.playing=!1;window.soundDisplay=!1;var coord=new Point(c.width/2,c.height/2);player=void 0;cursor=new Cursor("#00FF00");cursor.setPoint(coord);selectShipLoop();
function fireProjectile(a,b){"l"!=a.type&&"p"!=a.type||a.fire(b)}function fireMissile(a,b){"m"==a.type&&a.fire(b)}var coord=new Point(c.width/2,c.height/2);function pegaCoordenadas(a){coord.x=a.clientX;coord.y=a.clientY}function pegaCoordenadasMobile(a){coord.x=a.touches[0].clientX;coord.y=a.touches[0].clientY;player.lock=!0;for(a=0;a<player.weapons.length;a++)player.weapons[a].fire(!0);player.setupAutoPilot(coord)}
keyboardDown=function(a){"."==a.key&&(window.soundDisplay=!0,clearTimeout(soundPool.timeoutId),soundPool.timeoutId=setTimeout(function(){window.soundDisplay=!1},2E3),increaseMusicVolume(selectMusic),increaseMusicVolume(music),soundPool.increaseVolume());","==a.key&&(window.soundDisplay=!0,clearTimeout(soundPool.timeoutId),soundPool.timeoutId=setTimeout(function(){window.soundDisplay=!1},2E3),decreaseMusicVolume(selectMusic),decreaseMusicVolume(music),soundPool.decreaseVolume());if("v"==a.key)for(var b=
0;b<player.weapons.length;b++)weapon=player.weapons[b],fireMissile(weapon,!0);"Escape"==a.key&&(instruct=!0,player.dead&&(playing=!1));if("c"==a.key)for(b=0;b<player.weapons.length;b++)player.weapons[b].autoFire();"r"==a.key&&player.cycleEnabledWeapons();"f"==a.key&&(player.shield.enabled?player.shield.setEnabled(!1):player.shield.setEnabled(!0));if(void 0!=player&&!player.lock&&("w"!=a.key&&"ArrowUp"!=a.key||player.throttle(!0),"x"==a.key&&player.reverseThrottle(!0),"q"==a.key&&player.strafe("l",
!0),"e"==a.key&&player.strafe("r",!0),"s"!=a.key&&"ArrowDown"!=a.key||player.brake(!0),"d"!=a.key&&"ArrowRight"!=a.key||player.turn("r",!0),"a"!=a.key&&"ArrowLeft"!=a.key||player.turn("l",!0),"t"==a.key&&player.targetSystem.changeTarget(),"u"==a.key&&(player.lock=!0,player.setupAutoPilot(coord)),"h"==a.key))for(b=0;b<player.weapons.length;b++)player.weapons[b].turret&&(oldMode=player.weapons[b].mode,"m"==oldMode?(oldMode="a",player.targetSystem.setAutoAim(!0,player.weapons)):(oldMode="m",player.targetSystem.setAutoAim(!1,
player.weapons),player.targetSystem.autoFiring=!1),player.weapons[b].mode=oldMode)};
keyboardUp=function(a){"Escape"==a.key&&(instruct=!1,player.lock&&(player.lock=!1));if("v"==a.key)for(var b=0;b<player.weapons.length;b++)weapon=player.weapons[b],fireMissile(weapon,!1);void 0==player||player.lock||("w"!=a.key&&"ArrowUp"!=a.key||player.throttle(!1),"x"==a.key&&player.reverseThrottle(!1),"q"==a.key&&player.strafe("l",!1),"e"==a.key&&player.strafe("r",!1),"s"!=a.key&&"ArrowDown"!=a.key||player.brake(!1),"d"!=a.key&&"ArrowRight"!=a.key||player.turn("r",!1),"a"!=a.key&&"ArrowLeft"!=a.key||
player.turn("l",!1))};buttonModeClick=function(){if(void 0!=buttons)for(var a=0;a<buttons.length;a++){var b=buttons[a].x+buttons[a].width,d=buttons[a].y,e=buttons[a].y+buttons[a].height;if(coord.x>buttons[a].x&&coord.x<b&&coord.y>d&&coord.y<e)buttons[a].onClick()}};
buttonModeHover=function(){if(void 0!=buttons)for(var a=0;a<buttons.length;a++){var b=buttons[a].x+buttons[a].width,d=buttons[a].y,e=buttons[a].y+buttons[a].height;if(coord.x>buttons[a].x&&coord.x<b&&coord.y>d&&coord.y<e)buttons[a].onHover();else buttons[a].reset()}};
function mouseDown(a){if(void 0!=player)if(1==a.which)for(a=0;a<player.weapons.length;a++)weapon=player.weapons[a],weapon.turret&&fireProjectile(weapon,!0);else if(3==a.which)for(a=0;a<player.weapons.length;a++)weapon=player.weapons[a],weapon.turret&&fireMissile(weapon,!0)}
function mouseUp(a){if(void 0!=player)if(1==a.which)for(a=0;a<player.weapons.length;a++)weapon=player.weapons[a],weapon.turret&&fireProjectile(weapon,!1);else if(3==a.which)for(a=0;a<player.weapons.length;a++)weapon=player.weapons[a],weapon.turret&&fireMissile(weapon,!1)}window.addEventListener("keydown",function(a){keyboardDown(a)},!1);window.addEventListener("keyup",function(a){keyboardUp(a)},!1);c.addEventListener("mousemove",pegaCoordenadas,!1);c.addEventListener("mousemove",buttonModeHover,!1);
c.addEventListener("touchstart",buttonModeClick,!1);c.addEventListener("mousedown",function(a){mouseDown(a)},!1);c.addEventListener("mouseup",function(a){mouseUp(a)},!1);c.addEventListener("click",function(a){buttonModeClick(a)},!1);window.addEventListener("keydown",function(a){if(32==a.keyCode&&a.target==document.body)for(a.preventDefault(),a=0;a<player.weapons.length;a++)weapon=player.weapons[a],0==weapon.turret&&fireProjectile(weapon,!0)});
window.addEventListener("keyup",function(a){if(32==a.keyCode&&a.target==document.body)for(a.preventDefault(),a=0;a<player.weapons.length;a++)weapon=player.weapons[a],0==weapon.turret&&fireProjectile(weapon,!1)});function rightclick(){var a,b=window.event;b.which?a=3==b.which:b.button&&(a=2==b.button);alert(a)}window.addEventListener("contextmenu",function(a){a.preventDefault()});
</script>
</body>
</body>

</html>
